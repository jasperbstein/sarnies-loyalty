(()=>{var e={};e.id=3288,e.ids=[3288],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},98955:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.Z,__next_app__:()=>c,originalPathname:()=>o,pages:()=>x,routeModule:()=>u,tree:()=>d}),s(6645),s(95478),s(26083),s(96560);var r=s(23191),a=s(88716),l=s(48001),n=s(95231),i={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>n[e]);s.d(t,i);let d=["",{children:["admin",{children:["pos-keys",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,6645)),"/root/Loyalty/frontend/app/admin/pos-keys/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,95478)),"/root/Loyalty/frontend/app/layout.tsx"],error:[()=>Promise.resolve().then(s.bind(s,26083)),"/root/Loyalty/frontend/app/error.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"/root/Loyalty/frontend/app/not-found.tsx"]}],x=["/root/Loyalty/frontend/app/admin/pos-keys/page.tsx"],o="/admin/pos-keys/page",c={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/pos-keys/page",pathname:"/admin/pos-keys",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},91331:(e,t,s)=>{Promise.resolve().then(s.bind(s,90155))},90155:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var r=s(10326),a=s(17577),l=s(36143),n=s(6824),i=s(83855),d=s(76557);let x=(0,d.Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),o=(0,d.Z)("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);var c=s(66697),u=s(96633),p=s(941),m=s(98091),h=s(37202),b=s(32933),y=s(43810),g=s(55358),j=s.n(g);function f(){let[e,t]=(0,a.useState)([]),[s,d]=(0,a.useState)(!0),[g,f]=(0,a.useState)(!1),[v,N]=(0,a.useState)(""),[k,w]=(0,a.useState)(""),[P,_]=(0,a.useState)(null),[C,S]=(0,a.useState)(!1),[A,q]=(0,a.useState)(null),[Z,I]=(0,a.useState)({}),[L,z]=(0,a.useState)(null),[K,M]=(0,a.useState)(!1),[T,O]=(0,a.useState)(null),R=async()=>{d(!0);try{let e=await n.xf.getAll();t(e.data.keys||[])}catch(e){j().error("Failed to load API keys")}finally{d(!1)}},E=async e=>{if(Z[e]){q(A===e?null:e);return}z(e);try{let t=await n.xf.getLogs(e,{limit:20});I(s=>({...s,[e]:t.data.logs||[]})),q(e)}catch(e){j().error("Failed to load transaction logs")}finally{z(null)}},G=async()=>{if(!v.trim()){j().error("Please enter a key name");return}M(!0);try{let e=await n.xf.create({name:v.trim(),outlet_id:k?parseInt(k):void 0});_(e.data.apiKey),j().success("API key created successfully"),R()}catch(e){j().error(e.response?.data?.error||"Failed to create API key")}finally{M(!1)}},F=async()=>{if(T)try{await n.xf.revoke(T.id),j().success("API key revoked successfully"),O(null),R()}catch(e){j().error(e.response?.data?.error||"Failed to revoke API key")}},H=e=>{navigator.clipboard.writeText(e),S(!0),j().success("Copied to clipboard"),setTimeout(()=>S(!1),2e3)},V=()=>{f(!1),N(""),w(""),_(null),S(!1)},X=e=>e?new Date(e).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";return(0,r.jsxs)(l.Z,{children:[r.jsx("div",{className:"min-h-screen bg-neutral-50",children:(0,r.jsxs)("div",{className:"max-w-[1400px] mx-auto px-6 py-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-[28px] font-semibold text-neutral-900",children:"POS API Keys"}),r.jsx("p",{className:"text-[14px] text-neutral-500 mt-1",children:"Manage API keys for external POS integrations"})]}),(0,r.jsxs)("button",{onClick:()=>f(!0),className:"h-[40px] px-4 rounded-lg bg-neutral-900 text-white hover:bg-neutral-800 text-[14px] font-medium transition-all flex items-center gap-2",children:[r.jsx(i.Z,{size:16}),"Create API Key"]})]}),r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6",children:(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx(x,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-[14px] font-semibold text-blue-900 mb-1",children:"External POS Integration"}),r.jsx("p",{className:"text-[13px] text-blue-700",children:"API keys allow external POS systems to submit transactions and look up customers. Each key is shown only once when created. Store it securely."}),(0,r.jsxs)("div",{className:"mt-3 flex gap-4 text-[12px]",children:[r.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"POST /api/pos/transaction"}),r.jsx("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"GET /api/pos/lookup/:identifier"})]})]})]})}),(0,r.jsxs)("div",{className:"bg-white border border-neutral-200 rounded-xl shadow-sm overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center h-[48px] px-6 border-b border-neutral-200 bg-neutral-50 text-[11px] font-semibold uppercase tracking-wider text-neutral-600",children:[r.jsx("div",{className:"w-[200px]",children:"Name"}),r.jsx("div",{className:"w-[160px]",children:"Key Prefix"}),r.jsx("div",{className:"w-[100px]",children:"Status"}),r.jsx("div",{className:"w-[140px]",children:"Last Used"}),r.jsx("div",{className:"w-[100px] text-right",children:"Requests"}),r.jsx("div",{className:"w-[100px] text-right",children:"Transactions"}),r.jsx("div",{className:"w-[140px]",children:"Created"}),r.jsx("div",{className:"flex-1"})]}),s?r.jsx("div",{className:"flex items-center justify-center h-40 text-[14px] text-neutral-500",children:"Loading API keys..."}):0===e.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 px-4",children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-neutral-100 flex items-center justify-center mb-4",children:r.jsx(o,{size:24,className:"text-neutral-400"})}),r.jsx("h3",{className:"text-[16px] font-semibold text-neutral-900 mb-1",children:"No API Keys"}),r.jsx("p",{className:"text-[14px] text-neutral-500 mb-4",children:"Create your first API key to enable POS integration."}),(0,r.jsxs)("button",{onClick:()=>f(!0),className:"h-[36px] px-4 rounded-lg bg-neutral-900 text-white hover:bg-neutral-800 text-[14px] font-medium transition-all flex items-center gap-2",children:[r.jsx(i.Z,{size:16}),"Create API Key"]})]}):e.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center h-[60px] px-6 border-b border-neutral-100 last:border-0 hover:bg-neutral-50 transition-colors",children:[r.jsx("div",{className:"w-[200px]",children:r.jsx("p",{className:"text-[14px] font-medium text-neutral-900",children:e.name})}),r.jsx("div",{className:"w-[160px]",children:(0,r.jsxs)("code",{className:"text-[13px] font-mono text-neutral-600 bg-neutral-100 px-2 py-1 rounded",children:[e.key_prefix,"..."]})}),r.jsx("div",{className:"w-[100px]",children:r.jsx("span",{className:`inline-flex items-center h-[24px] px-2 rounded-md text-[12px] font-medium ${e.is_active?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:e.is_active?"Active":"Revoked"})}),r.jsx("div",{className:"w-[140px] text-[13px] text-neutral-600",children:X(e.last_used_at)}),r.jsx("div",{className:"w-[100px] text-right text-[14px] font-medium text-neutral-900 font-mono",children:e.total_requests.toLocaleString()}),r.jsx("div",{className:"w-[100px] text-right text-[14px] font-medium text-neutral-900 font-mono",children:e.total_transactions.toLocaleString()}),r.jsx("div",{className:"w-[140px] text-[13px] text-neutral-500",children:X(e.created_at)}),(0,r.jsxs)("div",{className:"flex-1 flex justify-end gap-2",children:[(0,r.jsxs)("button",{onClick:()=>E(e.id),className:"h-[32px] px-3 rounded-lg border border-neutral-300 bg-white text-neutral-700 hover:bg-neutral-50 text-[13px] font-medium transition-all flex items-center gap-1.5",disabled:L===e.id,children:[r.jsx(c.Z,{size:14}),"Logs",A===e.id?r.jsx(u.Z,{size:14}):r.jsx(p.Z,{size:14})]}),e.is_active&&(0,r.jsxs)("button",{onClick:()=>O(e),className:"h-[32px] px-3 rounded-lg border border-red-200 bg-white text-red-600 hover:bg-red-50 text-[13px] font-medium transition-all flex items-center gap-1.5",children:[r.jsx(m.Z,{size:14}),"Revoke"]})]})]}),A===e.id&&(0,r.jsxs)("div",{className:"bg-neutral-50 border-b border-neutral-200 px-6 py-4",children:[r.jsx("h4",{className:"text-[13px] font-semibold text-neutral-700 mb-3",children:"Recent Transaction Logs"}),L===e.id?r.jsx("p",{className:"text-[13px] text-neutral-500",children:"Loading logs..."}):Z[e.id]?.length===0?r.jsx("p",{className:"text-[13px] text-neutral-500",children:"No transactions recorded yet."}):r.jsx("div",{className:"space-y-2",children:Z[e.id]?.map(e=>r.jsxs("div",{className:"flex items-center gap-4 bg-white rounded-lg px-4 py-3 border border-neutral-200",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-[13px] font-mono text-neutral-600",children:e.external_transaction_id}),r.jsx("span",{className:`inline-flex items-center h-[20px] px-1.5 rounded text-[11px] font-medium ${"success"===e.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:e.status})]}),r.jsxs("p",{className:"text-[12px] text-neutral-500 mt-0.5",children:[e.customer_phone," • ",e.outlet]})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("p",{className:"text-[14px] font-medium text-neutral-900",children:["฿",e.amount_thb.toLocaleString()]}),r.jsxs("p",{className:"text-[12px] text-green-600",children:["+",e.points_earned," pts"]})]}),r.jsx("div",{className:"text-[12px] text-neutral-400 w-[120px] text-right",children:X(e.created_at)})]},e.id))})]})]},e.id))]})]})}),g&&(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:V}),(0,r.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-xl w-[480px] max-h-[90vh] overflow-y-auto",children:[r.jsx("div",{className:"p-6 border-b border-neutral-200",children:r.jsx("h2",{className:"text-[20px] font-semibold text-neutral-900",children:P?"API Key Created":"Create API Key"})}),r.jsx("div",{className:"p-6",children:P?(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx(h.Z,{className:"w-5 h-5 text-amber-600 flex-shrink-0"}),(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-[14px] font-semibold text-amber-800 mb-1",children:"Save this key now"}),r.jsx("p",{className:"text-[13px] text-amber-700",children:"This is the only time you'll see this API key. Copy and store it securely."})]})]})}),r.jsx("div",{className:"bg-neutral-100 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("code",{className:"text-[14px] font-mono text-neutral-900 break-all",children:P}),r.jsx("button",{onClick:()=>H(P),className:"ml-3 p-2 rounded-lg hover:bg-neutral-200 transition-colors flex-shrink-0",children:C?r.jsx(b.Z,{size:18,className:"text-green-600"}):r.jsx(y.Z,{size:18,className:"text-neutral-600"})})]})}),(0,r.jsxs)("div",{className:"bg-neutral-50 rounded-lg p-4 text-[13px] text-neutral-600",children:[r.jsx("p",{className:"font-semibold text-neutral-800 mb-2",children:"Usage:"}),(0,r.jsxs)("code",{className:"block bg-neutral-900 text-green-400 p-3 rounded-lg text-[12px] overflow-x-auto",children:["curl -X POST https://loyalty.sarnies.tech/api/pos/transaction \\",r.jsx("br",{}),'\xa0\xa0-H "X-API-Key: ',P.substring(0,20),'..." \\',r.jsx("br",{}),'\xa0\xa0-H "Content-Type: application/json" \\',r.jsx("br",{}),"\xa0\xa0-d '",'{"customer_phone": "+66...", "amount_thb": 100, ...}',"'"]})]})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-[13px] font-semibold text-neutral-700 mb-1.5",children:"Key Name"}),r.jsx("input",{type:"text",value:v,onChange:e=>N(e.target.value),placeholder:"e.g., Main POS System",className:"w-full h-[40px] px-3 border border-neutral-300 rounded-lg text-[14px] text-neutral-900 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent"}),r.jsx("p",{className:"text-[12px] text-neutral-500 mt-1",children:"A descriptive name to identify this API key"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-[13px] font-semibold text-neutral-700 mb-1.5",children:"Outlet ID (Optional)"}),r.jsx("input",{type:"text",value:k,onChange:e=>w(e.target.value),placeholder:"Leave empty for all outlets",className:"w-full h-[40px] px-3 border border-neutral-300 rounded-lg text-[14px] text-neutral-900 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent"}),r.jsx("p",{className:"text-[12px] text-neutral-500 mt-1",children:"Restrict this key to a specific outlet"})]})]})}),(0,r.jsxs)("div",{className:"p-6 border-t border-neutral-200 flex justify-end gap-3",children:[r.jsx("button",{onClick:V,className:"h-[40px] px-4 rounded-lg border border-neutral-300 bg-white text-neutral-700 hover:bg-neutral-50 text-[14px] font-medium transition-all",children:P?"Close":"Cancel"}),!P&&r.jsx("button",{onClick:G,disabled:K||!v.trim(),className:"h-[40px] px-4 rounded-lg bg-neutral-900 text-white hover:bg-neutral-800 text-[14px] font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:K?"Creating...":"Create Key"})]})]})]}),T&&(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>O(null)}),(0,r.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-xl w-[400px]",children:[(0,r.jsxs)("div",{className:"p-6",children:[r.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center mb-4",children:r.jsx(h.Z,{size:24,className:"text-red-600"})}),r.jsx("h2",{className:"text-[20px] font-semibold text-neutral-900 mb-2",children:"Revoke API Key"}),(0,r.jsxs)("p",{className:"text-[14px] text-neutral-600 mb-4",children:["Are you sure you want to revoke ",r.jsx("strong",{children:T.name}),"? This action cannot be undone and any systems using this key will stop working immediately."]})]}),(0,r.jsxs)("div",{className:"p-6 border-t border-neutral-200 flex justify-end gap-3",children:[r.jsx("button",{onClick:()=>O(null),className:"h-[40px] px-4 rounded-lg border border-neutral-300 bg-white text-neutral-700 hover:bg-neutral-50 text-[14px] font-medium transition-all",children:"Cancel"}),r.jsx("button",{onClick:F,className:"h-[40px] px-4 rounded-lg bg-red-600 text-white hover:bg-red-700 text-[14px] font-medium transition-all",children:"Revoke Key"})]})]})]})]})}},66697:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(76557).Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]])},32933:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(76557).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},43810:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(76557).Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},83855:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(76557).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},98091:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(76557).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},6645:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(68570).createProxy)(String.raw`/root/Loyalty/frontend/app/admin/pos-keys/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[5380,2696,4464,5814,9538],()=>s(98955));module.exports=r})();