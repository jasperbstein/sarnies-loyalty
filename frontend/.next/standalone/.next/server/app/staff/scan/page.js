(()=>{var e={};e.id=2719,e.ids=[2719],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},35240:e=>{"use strict";e.exports=require("https")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},76162:e=>{"use strict";e.exports=require("stream")},74175:e=>{"use strict";e.exports=require("tty")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},42163:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.Z,__next_app__:()=>h,originalPathname:()=>c,pages:()=>d,routeModule:()=>m,tree:()=>o}),s(33439),s(95478),s(26083),s(96560);var a=s(23191),r=s(88716),i=s(48001),n=s(95231),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);s.d(t,l);let o=["",{children:["staff",{children:["scan",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,33439)),"/root/Loyalty/frontend/app/staff/scan/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,95478)),"/root/Loyalty/frontend/app/layout.tsx"],error:[()=>Promise.resolve().then(s.bind(s,26083)),"/root/Loyalty/frontend/app/error.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,96560)),"/root/Loyalty/frontend/app/not-found.tsx"]}],d=["/root/Loyalty/frontend/app/staff/scan/page.tsx"],c="/staff/scan/page",h={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/staff/scan/page",pathname:"/staff/scan",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},70972:(e,t,s)=>{Promise.resolve().then(s.bind(s,24478))},24478:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>D});var a=s(10326),r=s(17577),i=s(36143),n=s(85567),l=s(76557);let o=(0,l.Z)("SwitchCamera",[["path",{d:"M11 19H4a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h5",key:"mtk2lu"}],["path",{d:"M13 5h7a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-5",key:"120jsl"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m18 22-3-3 3-3",key:"kgdoj7"}],["path",{d:"m6 2 3 3-3 3",key:"1fnbkv"}]]);var d=s(94019);class c{constructor(e,t,s,a,r){this._legacyCanvasSize=c.DEFAULT_CANVAS_SIZE,this._preferredCamera="environment",this._maxScansPerSecond=25,this._lastScanTimestamp=-1,this._destroyed=this._flashOn=this._paused=this._active=!1,this.$video=e,this.$canvas=document.createElement("canvas"),s&&"object"==typeof s?this._onDecode=t:(s||a||r?console.warn("You're using a deprecated version of the QrScanner constructor which will be removed in the future"):console.warn("Note that the type of the scan result passed to onDecode will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),this._legacyOnDecode=t),t="object"==typeof s?s:{},this._onDecodeError=t.onDecodeError||("function"==typeof s?s:this._onDecodeError),this._calculateScanRegion=t.calculateScanRegion||("function"==typeof a?a:this._calculateScanRegion),this._preferredCamera=t.preferredCamera||r||this._preferredCamera,this._legacyCanvasSize="number"==typeof s?s:"number"==typeof a?a:this._legacyCanvasSize,this._maxScansPerSecond=t.maxScansPerSecond||this._maxScansPerSecond,this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this._updateOverlay=this._updateOverlay.bind(this),e.disablePictureInPicture=!0,e.playsInline=!0,e.muted=!0;let i=!1;if(e.hidden&&(e.hidden=!1,i=!0),document.body.contains(e)||(document.body.appendChild(e),i=!0),s=e.parentElement,t.highlightScanRegion||t.highlightCodeOutline){if(a=!!t.overlay,this.$overlay=t.overlay||document.createElement("div"),(r=this.$overlay.style).position="absolute",r.display="none",r.pointerEvents="none",this.$overlay.classList.add("scan-region-highlight"),!a&&t.highlightScanRegion){this.$overlay.innerHTML='<svg class="scan-region-highlight-svg" viewBox="0 0 238 238" preserveAspectRatio="none" style="position:absolute;width:100%;height:100%;left:0;top:0;fill:none;stroke:#e9b213;stroke-width:4;stroke-linecap:round;stroke-linejoin:round"><path d="M31 2H10a8 8 0 0 0-8 8v21M207 2h21a8 8 0 0 1 8 8v21m0 176v21a8 8 0 0 1-8 8h-21m-176 0H10a8 8 0 0 1-8-8v-21"/></svg>';try{this.$overlay.firstElementChild.animate({transform:["scale(.98)","scale(1.01)"]},{duration:400,iterations:1/0,direction:"alternate",easing:"ease-in-out"})}catch(e){}s.insertBefore(this.$overlay,this.$video.nextSibling)}t.highlightCodeOutline&&(this.$overlay.insertAdjacentHTML("beforeend",'<svg class="code-outline-highlight" preserveAspectRatio="none" style="display:none;width:100%;height:100%;fill:none;stroke:#e9b213;stroke-width:5;stroke-dasharray:25;stroke-linecap:round;stroke-linejoin:round"><polygon/></svg>'),this.$codeOutlineHighlight=this.$overlay.lastElementChild)}this._scanRegion=this._calculateScanRegion(e),requestAnimationFrame(()=>{let t=window.getComputedStyle(e);"none"===t.display&&(e.style.setProperty("display","block","important"),i=!0),"visible"!==t.visibility&&(e.style.setProperty("visibility","visible","important"),i=!0),i&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),e.style.opacity="0",e.style.width="0",e.style.height="0",this.$overlay&&this.$overlay.parentElement&&this.$overlay.parentElement.removeChild(this.$overlay),delete this.$overlay,delete this.$codeOutlineHighlight),this.$overlay&&this._updateOverlay()}),e.addEventListener("play",this._onPlay),e.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),window.addEventListener("resize",this._updateOverlay),this._qrEnginePromise=c.createQrEngine()}static set WORKER_PATH(e){console.warn("Setting QrScanner.WORKER_PATH is not required and not supported anymore. Have a look at the README for new setup instructions.")}static async hasCamera(){try{return!!(await c.listCameras(!1)).length}catch(e){return!1}}static async listCameras(e=!1){if(!navigator.mediaDevices)return[];let t=async()=>(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind),s;try{e&&(await t()).every(e=>!e.label)&&(s=await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}))}catch(e){}try{return(await t()).map((e,t)=>({id:e.deviceId,label:e.label||(0===t?"Default Camera":`Camera ${t+1}`)}))}finally{s&&(console.warn("Call listCameras after successfully starting a QR scanner to avoid creating a temporary video stream"),c._stopVideoStream(s))}}async hasFlash(){let e;try{if(this.$video.srcObject){if(!(this.$video.srcObject instanceof MediaStream))return!1;e=this.$video.srcObject}else e=(await this._getCameraStream()).stream;return"torch"in e.getVideoTracks()[0].getSettings()}catch(e){return!1}finally{e&&e!==this.$video.srcObject&&(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),c._stopVideoStream(e))}}isFlashOn(){return this._flashOn}async toggleFlash(){this._flashOn?await this.turnFlashOff():await this.turnFlashOn()}async turnFlashOn(){if(!this._flashOn&&!this._destroyed&&(this._flashOn=!0,this._active&&!this._paused))try{if(!await this.hasFlash())throw"No flash available";await this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]})}catch(e){throw this._flashOn=!1,e}}async turnFlashOff(){this._flashOn&&(this._flashOn=!1,await this._restartVideoStream())}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("resize",this._updateOverlay),this._destroyed=!0,this._flashOn=!1,this.stop(),c._postWorkerMessage(this._qrEnginePromise,"close")}async start(){if(this._destroyed)throw Error("The QR scanner can not be started as it had been destroyed.");if((!this._active||this._paused)&&("https:"!==window.location.protocol&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,!document.hidden)){if(this._paused=!1,this.$video.srcObject)await this.$video.play();else try{let{stream:e,facingMode:t}=await this._getCameraStream();!this._active||this._paused?c._stopVideoStream(e):(this._setVideoMirror(t),this.$video.srcObject=e,await this.$video.play(),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{})))}catch(e){if(!this._paused)throw this._active=!1,e}}}stop(){this.pause(),this._active=!1}async pause(e=!1){if(this._paused=!0,!this._active)return!0;this.$video.pause(),this.$overlay&&(this.$overlay.style.display="none");let t=()=>{this.$video.srcObject instanceof MediaStream&&(c._stopVideoStream(this.$video.srcObject),this.$video.srcObject=null)};return e?(t(),!0):(await new Promise(e=>setTimeout(e,300)),!!this._paused&&(t(),!0))}async setCamera(e){e!==this._preferredCamera&&(this._preferredCamera=e,await this._restartVideoStream())}static async scanImage(e,t,s,a,r=!1,i=!1){let n,l=!1;t&&("scanRegion"in t||"qrEngine"in t||"canvas"in t||"disallowCanvasResizing"in t||"alsoTryWithoutScanRegion"in t||"returnDetailedScanResult"in t)?(n=t.scanRegion,s=t.qrEngine,a=t.canvas,r=t.disallowCanvasResizing||!1,i=t.alsoTryWithoutScanRegion||!1,l=!0):t||s||a||r||i?console.warn("You're using a deprecated api for scanImage which will be removed in the future."):console.warn("Note that the return type of scanImage will change in the future. To already switch to the new api today, you can pass returnDetailedScanResult: true."),t=!!s;try{let o,d,h;if([s,o]=await Promise.all([s||c.createQrEngine(),c._loadImage(e)]),[a,d]=c._drawToCanvas(o,n,a,r),s instanceof Worker){let e=s;t||c._postWorkerMessageSync(e,"inversionMode","both"),h=await new Promise((t,s)=>{let r,i,l,o=-1;i=a=>{a.data.id===o&&(e.removeEventListener("message",i),e.removeEventListener("error",l),clearTimeout(r),null!==a.data.data?t({data:a.data.data,cornerPoints:c._convertPoints(a.data.cornerPoints,n)}):s(c.NO_QR_CODE_FOUND))},l=t=>{e.removeEventListener("message",i),e.removeEventListener("error",l),clearTimeout(r),s("Scanner error: "+(t?t.message||t:"Unknown Error"))},e.addEventListener("message",i),e.addEventListener("error",l),r=setTimeout(()=>l("timeout"),1e4);let h=d.getImageData(0,0,a.width,a.height);o=c._postWorkerMessageSync(e,"decode",h,[h.data.buffer])})}else h=await Promise.race([new Promise((e,t)=>window.setTimeout(()=>t("Scanner error: timeout"),1e4)),(async()=>{try{var[t]=await s.detect(a);if(!t)throw c.NO_QR_CODE_FOUND;return{data:t.rawValue,cornerPoints:c._convertPoints(t.cornerPoints,n)}}catch(s){if(t=s.message||s,/not implemented|service unavailable/.test(t))return c._disableBarcodeDetector=!0,c.scanImage(e,{scanRegion:n,canvas:a,disallowCanvasResizing:r,alsoTryWithoutScanRegion:i});throw`Scanner error: ${t}`}})()]);return l?h:h.data}catch(o){if(!n||!i)throw o;let t=await c.scanImage(e,{qrEngine:s,canvas:a,disallowCanvasResizing:r});return l?t:t.data}finally{t||c._postWorkerMessage(s,"close")}}setGrayscaleWeights(e,t,s,a=!0){c._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:s,useIntegerApproximation:a})}setInversionMode(e){c._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static async createQrEngine(e){if(e&&console.warn("Specifying a worker path is not required and not supported anymore."),e=()=>s.e(5613).then(s.bind(s,35613)).then(e=>e.createWorker()),!(!c._disableBarcodeDetector&&"BarcodeDetector"in window&&BarcodeDetector.getSupportedFormats&&(await BarcodeDetector.getSupportedFormats()).includes("qr_code")))return e();let t=navigator.userAgentData;return t&&t.brands.some(({brand:e})=>/Chromium/i.test(e))&&/mac ?OS/i.test(t.platform)&&await t.getHighEntropyValues(["architecture","platformVersion"]).then(({architecture:e,platformVersion:t})=>/arm/i.test(e||"arm")&&13<=parseInt(t||"13")).catch(()=>!0)?e():new BarcodeDetector({formats:["qr_code"]})}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay(),this.$overlay&&(this.$overlay.style.display=""),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video),this._updateOverlay()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(e){let t=Math.round(2/3*Math.min(e.videoWidth,e.videoHeight));return{x:Math.round((e.videoWidth-t)/2),y:Math.round((e.videoHeight-t)/2),width:t,height:t,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_updateOverlay(){requestAnimationFrame(()=>{if(this.$overlay){var e=this.$video,t=e.videoWidth,s=e.videoHeight,a=e.offsetWidth,r=e.offsetHeight,i=e.offsetLeft,n=e.offsetTop,l=window.getComputedStyle(e),o=l.objectFit,d=t/s,c=a/r;switch(o){case"none":var h=t,m=s;break;case"fill":h=a,m=r;break;default:("cover"===o?d>c:d<c)?h=(m=r)*d:m=(h=a)/d,"scale-down"===o&&(h=Math.min(h,t),m=Math.min(m,s))}var[u,x]=l.objectPosition.split(" ").map((e,t)=>{let s=parseFloat(e);return e.endsWith("%")?(t?r-m:a-h)*s/100:s});l=this._scanRegion.width||t,c=this._scanRegion.height||s,o=this._scanRegion.x||0;var p=this._scanRegion.y||0;(d=this.$overlay.style).width=`${l/t*h}px`,d.height=`${c/s*m}px`,d.top=`${n+x+p/s*m}px`,s=/scaleX\(-1\)/.test(e.style.transform),d.left=`${i+(s?a-u-h:u)+(s?t-o-l:o)/t*h}px`,d.transform=e.style.transform}})}static _convertPoints(e,t){if(!t)return e;let s=t.x||0,a=t.y||0,r=t.width&&t.downScaledWidth?t.width/t.downScaledWidth:1;for(let i of(t=t.height&&t.downScaledHeight?t.height/t.downScaledHeight:1,e))i.x=i.x*r+s,i.y=i.y*t+a;return e}_scanFrame(){!this._active||this.$video.paused||this.$video.ended||("requestVideoFrameCallback"in this.$video?this.$video.requestVideoFrameCallback.bind(this.$video):requestAnimationFrame)(async()=>{if(!(1>=this.$video.readyState)){var e=Date.now()-this._lastScanTimestamp,t=1e3/this._maxScansPerSecond;e<t&&await new Promise(s=>setTimeout(s,t-e)),this._lastScanTimestamp=Date.now();try{var s=await c.scanImage(this.$video,{scanRegion:this._scanRegion,qrEngine:this._qrEnginePromise,canvas:this.$canvas})}catch(e){if(!this._active)return;this._onDecodeError(e)}!c._disableBarcodeDetector||await this._qrEnginePromise instanceof Worker||(this._qrEnginePromise=c.createQrEngine()),s?(this._onDecode?this._onDecode(s):this._legacyOnDecode&&this._legacyOnDecode(s.data),this.$codeOutlineHighlight&&(clearTimeout(this._codeOutlineHighlightRemovalTimeout),this._codeOutlineHighlightRemovalTimeout=void 0,this.$codeOutlineHighlight.setAttribute("viewBox",`${this._scanRegion.x||0} ${this._scanRegion.y||0} ${this._scanRegion.width||this.$video.videoWidth} ${this._scanRegion.height||this.$video.videoHeight}`),this.$codeOutlineHighlight.firstElementChild.setAttribute("points",s.cornerPoints.map(({x:e,y:t})=>`${e},${t}`).join(" ")),this.$codeOutlineHighlight.style.display="")):this.$codeOutlineHighlight&&!this._codeOutlineHighlightRemovalTimeout&&(this._codeOutlineHighlightRemovalTimeout=setTimeout(()=>this.$codeOutlineHighlight.style.display="none",100))}this._scanFrame()})}_onDecodeError(e){e!==c.NO_QR_CODE_FOUND&&console.log(e)}async _getCameraStream(){if(!navigator.mediaDevices)throw"Camera not found.";let e=/^(environment|user)$/.test(this._preferredCamera)?"facingMode":"deviceId",t=[{width:{min:1024}},{width:{min:768}},{}];for(let s of[...t.map(t=>Object.assign({},t,{[e]:{exact:this._preferredCamera}})),...t])try{let e=await navigator.mediaDevices.getUserMedia({video:s,audio:!1}),t=this._getFacingMode(e)||(s.facingMode?this._preferredCamera:"environment"===this._preferredCamera?"user":"environment");return{stream:e,facingMode:t}}catch(e){}throw"Camera not found."}async _restartVideoStream(){let e=this._paused;await this.pause(!0)&&!e&&this._active&&await this.start()}static _stopVideoStream(e){for(let t of e.getTracks())t.stop(),e.removeTrack(t)}_setVideoMirror(e){this.$video.style.transform="scaleX("+("user"===e?-1:1)+")"}_getFacingMode(e){return(e=e.getVideoTracks()[0])?/rear|back|environment/i.test(e.label)?"environment":/front|user|face/i.test(e.label)?"user":null:null}static _drawToCanvas(e,t,s,a=!1){s=s||document.createElement("canvas");let r=t&&t.x?t.x:0,i=t&&t.y?t.y:0,n=t&&t.width?t.width:e.videoWidth||e.width,l=t&&t.height?t.height:e.videoHeight||e.height;return a||(a=t&&t.downScaledWidth?t.downScaledWidth:n,t=t&&t.downScaledHeight?t.downScaledHeight:l,s.width!==a&&(s.width=a),s.height!==t&&(s.height=t)),(t=s.getContext("2d",{alpha:!1})).imageSmoothingEnabled=!1,t.drawImage(e,r,i,n,l,0,0,s.width,s.height),[s,t]}static async _loadImage(e){if(e instanceof Image)return await c._awaitImageLoad(e),e;if(e instanceof HTMLVideoElement||e instanceof HTMLCanvasElement||e instanceof SVGImageElement||"OffscreenCanvas"in window&&e instanceof OffscreenCanvas||"ImageBitmap"in window&&e instanceof ImageBitmap)return e;if(e instanceof File||e instanceof Blob||e instanceof URL||"string"==typeof e){let t=new Image;t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e.toString();try{return await c._awaitImageLoad(t),t}finally{(e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src)}}else throw"Unsupported image type."}static async _awaitImageLoad(e){e.complete&&0!==e.naturalWidth||await new Promise((t,s)=>{let a=r=>{e.removeEventListener("load",a),e.removeEventListener("error",a),r instanceof ErrorEvent?s("Image load error"):t()};e.addEventListener("load",a),e.addEventListener("error",a)})}static async _postWorkerMessage(e,t,s,a){return c._postWorkerMessageSync(await e,t,s,a)}static _postWorkerMessageSync(e,t,s,a){if(!(e instanceof Worker))return -1;let r=c._workerMessageId++;return e.postMessage({id:r,type:t,data:s},a),r}}c.DEFAULT_CANVAS_SIZE=400,c.NO_QR_CODE_FOUND="No QR code found",c._disableBarcodeDetector=!1,c._workerMessageId=0;let h=(0,r.forwardRef)(({onScan:e},t)=>{let[s,i]=(0,r.useState)(""),[l,c]=(0,r.useState)(!1),[h,m]=(0,r.useState)(""),[u,x]=(0,r.useState)(!1),[p,g]=(0,r.useState)([]),[b,y]=(0,r.useState)(""),f=(0,r.useRef)(null),v=(0,r.useRef)(!1),w=(0,r.useRef)(null),j=async e=>{try{throw m(""),v.current=!1,Error("Camera API not supported in this browser. Please use a modern browser like Chrome or Safari.")}catch(s){let e="Failed to start camera.",t=String(s);"PERMISSION_DENIED"===s.message||t.includes("NotAllowed")||t.includes("Permission")?e="Camera permission denied. Please allow camera access and try again.":"NO_CAMERA"===s.message||t.includes("NotFound")?e="No camera found on this device.":t.includes("NotReadable")||t.includes("in use")?e="Camera is already in use by another app.":s.message&&"PERMISSION_DENIED"!==s.message&&"NO_CAMERA"!==s.message&&(e=s.message),m(e),c(!1)}},N=async()=>{if(p.length<=1)return;let e=(p.findIndex(e=>e.id===b)+1)%p.length,t=p[e];if(f.current)try{await f.current.setCamera(t.id),y(t.id)}catch(e){await _(),await j(t.id)}},_=async()=>{if(f.current)try{f.current.stop(),f.current.destroy(),f.current=null}catch(e){}c(!1),x(!1)};return(0,r.useImperativeHandle)(t,()=>({startScanner:()=>{l||j()}})),(0,r.useEffect)(()=>(l?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow="",f.current&&_()}),[l]),a.jsx(a.Fragment,{children:l?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 bg-black",children:[a.jsx("video",{ref:w,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0,style:{transform:"scaleX(1)"}}),a.jsx("div",{className:"absolute top-0 left-0 right-0 bg-gradient-to-b from-black/80 to-transparent p-4 z-10",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(n.Z,{className:"w-6 h-6 text-yellow-400",strokeWidth:2}),a.jsx("h3",{className:"text-white font-bold text-lg",children:"Scan QR Code"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[p.length>1&&a.jsx("button",{onClick:N,className:"p-3 bg-white/20 backdrop-blur-sm text-white rounded-full hover:bg-white/30 transition-colors",title:"Switch Camera",children:a.jsx(o,{size:24})}),a.jsx("button",{onClick:_,className:"p-3 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors",title:"Close Camera",children:a.jsx(d.Z,{size:24})})]})]})}),!u&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-5",children:(0,a.jsxs)("div",{className:"relative w-72 h-72",children:[a.jsx("div",{className:"absolute -top-2 -left-2 w-16 h-16 border-l-4 border-t-4 border-yellow-400 rounded-tl-2xl"}),a.jsx("div",{className:"absolute -top-2 -right-2 w-16 h-16 border-r-4 border-t-4 border-yellow-400 rounded-tr-2xl"}),a.jsx("div",{className:"absolute -bottom-2 -left-2 w-16 h-16 border-l-4 border-b-4 border-yellow-400 rounded-bl-2xl"}),a.jsx("div",{className:"absolute -bottom-2 -right-2 w-16 h-16 border-r-4 border-b-4 border-yellow-400 rounded-br-2xl"}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsx("div",{className:"bg-black/50 backdrop-blur-sm p-4 rounded-2xl",children:a.jsx(n.Z,{className:"w-12 h-12 text-yellow-400 animate-pulse",strokeWidth:2})})})]})}),(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-6 z-10",children:[u?(0,a.jsxs)("div",{className:"bg-yellow-500 text-black px-6 py-4 rounded-xl text-center font-semibold shadow-lg flex items-center justify-center gap-2",children:[a.jsx(n.Z,{className:"w-5 h-5",strokeWidth:2.5}),a.jsx("span",{children:"QR Recognized — Loading..."})]}):(0,a.jsxs)("div",{className:"bg-white/20 backdrop-blur-sm text-white px-6 py-4 rounded-xl text-center",children:[a.jsx("p",{className:"font-medium",children:"Hold QR code steady inside the frame"}),a.jsx("p",{className:"text-sm text-white/80 mt-1",children:"Position 15-20cm from camera"})]}),p.length>1&&b&&(0,a.jsxs)("p",{className:"text-white/60 text-xs text-center mt-3",children:["Current: ",p.find(e=>e.id===b)?.label||"Unknown Camera"]})]}),u&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-20",children:(0,a.jsxs)("div",{className:"relative w-80 h-80",children:[a.jsx("div",{className:"absolute inset-0 border-4 border-yellow-400 rounded-2xl animate-pulse",style:{boxShadow:"0 0 40px rgba(250, 204, 21, 0.8)"}}),a.jsx("div",{className:"absolute -top-2 -left-2 w-16 h-16 border-l-4 border-t-4 border-yellow-300 rounded-tl-2xl"}),a.jsx("div",{className:"absolute -top-2 -right-2 w-16 h-16 border-r-4 border-t-4 border-yellow-300 rounded-tr-2xl"}),a.jsx("div",{className:"absolute -bottom-2 -left-2 w-16 h-16 border-l-4 border-b-4 border-yellow-300 rounded-bl-2xl"}),a.jsx("div",{className:"absolute -bottom-2 -right-2 w-16 h-16 border-r-4 border-b-4 border-yellow-300 rounded-br-2xl"}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-yellow-500 text-black rounded-full p-6 shadow-2xl relative",children:[a.jsx(n.Z,{className:"w-16 h-16",strokeWidth:2.5}),a.jsx("div",{className:"absolute -bottom-2 -right-2 bg-green-500 text-white rounded-full p-2 shadow-lg border-4 border-white",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]})})]})})]}):h&&a.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg mb-4",children:a.jsx("p",{className:"text-sm text-red-800",children:h})})})});h.displayName="QRScanner";var m=s(6762),u=s(25276);let x=(0,l.Z)("Cookie",[["path",{d:"M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5",key:"laymnq"}],["path",{d:"M8.5 8.5v.01",key:"ue8clq"}],["path",{d:"M16 15.5v.01",key:"14dtrp"}],["path",{d:"M12 12v.01",key:"u5ubse"}],["path",{d:"M11 17v.01",key:"1hyl5a"}],["path",{d:"M7 14v.01",key:"uct60s"}]]);var p=s(33734),g=s(1572),b=s(98908),y=s(48998),f=s(54659),v=s(87888);function w({customerId:e,pointsBalance:t,onApplyReward:s}){let[i,l]=(0,r.useState)(null),o=[{id:1,type:"voucher",title:"Free Coffee",description:"Any size hot coffee",value:"฿150",status:"available",isExpiring:!0,expiresAt:"Today at 11:59 PM",eligibilityReason:"Daily staff voucher"},{id:2,type:"employee_perk",title:"Staff Discount",description:"All menu items",value:"20% OFF",status:"available",discountValue:"20%",eligibilityReason:"Employee benefit"},{id:3,type:"free_item",title:"Free Pastry",description:"Any pastry from display",value:"25 pts",pointsCost:25,status:t>=25?"available":"expired",eligibilityReason:t>=25?"Earned reward":`Need ${25-t} more points`},{id:4,type:"partner_perk",title:"Partner Discount",description:"Valid at all branches",value:"15% OFF",status:"available",discountValue:"15%",eligibilityReason:"Partner program member"}].filter(e=>"expired"!==e.status||e.pointsCost),d=e=>{switch(e){case"voucher":return n.Z;case"discount":case"employee_perk":case"partner_perk":return u.Z;case"free_item":return x;case"points":return p.Z;case"vip_perk":return g.Z;default:return b.Z}},c=e=>"expired"===e.status?"bg-gray-50 border-gray-200 opacity-60":e.isExpiring?"bg-gradient-to-br from-orange-50 to-amber-50 border-orange-200 shadow-sm":"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200 shadow-sm",h=e=>{switch(e){case"voucher":return"bg-gradient-to-br from-green-500 to-green-600";case"employee_perk":return"bg-gradient-to-br from-blue-500 to-blue-600";case"partner_perk":return"bg-gradient-to-br from-purple-500 to-purple-600";case"free_item":return"bg-gradient-to-br from-amber-500 to-amber-600";case"vip_perk":return"bg-gradient-to-br from-orange-500 to-orange-600";default:return"bg-gradient-to-br from-gray-500 to-gray-600"}},m=e=>{"available"===e.status&&(l(e.id),setTimeout(()=>{s&&s(e.id,e.title),l(null)},500))};return 0===o.length?(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-8 border border-gray-200 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center",children:a.jsx(b.Z,{className:"w-5 h-5 text-gray-600"})}),a.jsx("h3",{className:"font-bold text-xl text-gray-900",children:"Eligible Rewards & Discounts"})]}),(0,a.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-xl border border-gray-200",children:[a.jsx(b.Z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500 font-medium",children:"No eligible rewards at this time"}),a.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Check back after customer earns more points"})]})]}):(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-5",children:[a.jsx("div",{className:"w-9 h-9 bg-green-100 rounded-lg flex items-center justify-center",children:a.jsx(b.Z,{className:"w-5 h-5 text-green-700"})}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-bold text-lg text-gray-900",children:"Eligible Rewards & Discounts"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-0.5",children:[o.length," reward",1!==o.length?"s":""," available"]})]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map(e=>{let t=d(e.type),s="available"===e.status,r=i===e.id;return(0,a.jsxs)("div",{className:`relative rounded-xl border-2 p-4 transition-all ${c(e)} ${s&&!r?"hover:shadow-md hover:scale-[1.02]":""}`,children:[e.isExpiring&&a.jsx("div",{className:"absolute top-2.5 right-2.5",children:(0,a.jsxs)("span",{className:"flex items-center gap-1 px-2 py-1 bg-orange-500 text-white text-[10px] font-bold rounded-full shadow-sm",children:[a.jsx(y.Z,{className:"w-3 h-3"}),e.expiresAt]})}),(0,a.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[a.jsx("div",{className:`w-12 h-12 ${h(e.type)} rounded-xl flex items-center justify-center flex-shrink-0 shadow-md`,children:a.jsx(t,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 pt-0.5",children:[a.jsx("h4",{className:"font-bold text-base text-gray-900 leading-tight mb-1",children:e.title}),a.jsx("p",{className:"text-xs text-gray-600 leading-snug",children:e.description})]})]}),a.jsx("div",{className:"mb-3",children:a.jsx("span",{className:"inline-block px-3 py-1.5 bg-white border-2 border-gray-900 rounded-lg font-black text-lg text-gray-900 shadow-sm",children:e.value})}),(0,a.jsxs)("div",{className:"mb-3 flex items-start gap-2",children:[a.jsx(f.Z,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),a.jsx("p",{className:"text-xs text-gray-700 font-medium leading-snug",children:e.eligibilityReason})]}),a.jsx("button",{onClick:()=>m(e),disabled:!s||r,className:`w-full py-2.5 rounded-lg font-bold text-sm transition-all ${s?"bg-gray-900 text-white hover:bg-gray-800 shadow-sm hover:shadow-md":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:r?"Applying...":s?"Apply Reward":"Not Available"})]},e.id)})}),a.jsx("div",{className:"mt-5 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[a.jsx(v.Z,{className:"w-5 h-5 text-blue-700 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm text-blue-900 font-semibold",children:"Staff Tip"}),a.jsx("p",{className:"text-sm text-blue-700 mt-0.5 leading-snug",children:'Click "Apply Reward" to apply a discount or voucher to the current transaction. Confirm with the customer before applying.'})]})]})})]})}var j=s(99048),N=s(6824),_=s(77636),k=s(51896);let S=(0,l.Z)("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);var C=s(18019),E=s(72257),R=s(22915),$=s(55358),P=s.n($);class O extends Error{}O.prototype.name="InvalidTokenError";var M=s(16205);function D(){let{user:e}=(0,M.t)(),[t,s]=(0,r.useState)("scan"),[n,l]=(0,r.useState)(null),[o,c]=(0,r.useState)(""),[u,x]=(0,r.useState)(""),[p,g]=(0,r.useState)(!1),[b,y]=(0,r.useState)(null),[$,D]=(0,r.useState)(""),[Z,L]=(0,r.useState)(""),[A,I]=(0,r.useState)(!1),[T,F]=(0,r.useState)(null),[q,V]=(0,r.useState)(null),[H,W]=(0,r.useState)(!1),z=(0,r.useRef)(null),Q=(0,r.useRef)(!1),U=(0,r.useRef)(null),B=()=>(U.current,U.current),G=()=>{let e=B();if(e){let t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=800,t.type="sine",s.gain.value=.3,t.start(),setTimeout(()=>t.stop(),100)}},X=()=>{let e=B();if(e){let t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=300,t.type="sawtooth",s.gain.value=.3,t.start(),setTimeout(()=>t.stop(),200)}},K=e=>{},J=async e=>{if(e&&!(e.trim().length<10)&&!Q.current){Q.current=!0,g(!0),D("");try{let t;let a=!1;try{t=JSON.parse(e)}catch{try{t=function(e,t){let s;if("string"!=typeof e)throw new O("Invalid token specified: must be a string");t||(t={});let a=!0===t.header?0:1,r=e.split(".")[a];if("string"!=typeof r)throw new O(`Invalid token specified: missing part #${a+1}`);try{s=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var s;return s=t,decodeURIComponent(atob(s).replace(/(.)/g,(e,t)=>{let s=t.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}catch(e){return atob(t)}}(r)}catch(e){throw new O(`Invalid token specified: invalid base64 for part #${a+1} (${e.message})`)}try{return JSON.parse(s)}catch(e){throw new O(`Invalid token specified: invalid json for part #${a+1} (${e.message})`)}}(e),a=!0}catch(e){throw Error("Invalid QR code format")}}if("voucher_redemption"===t.type){let e=await N.ZP.get(`/users/${t.customer_id}`),a=await N.ZP.get(`/vouchers/${t.voucher_id}`);l({type:"voucher_redemption",user:e.data,voucher:t}),y(a.data),s("redeem-voucher"),G(),K("success")}else if("loyalty_id"===t.type||a){let e=t.id||t.customer_id||t.userId;if(!e)throw Error("Customer ID not found in QR code");"string"==typeof e&&(e=parseInt(e,10));let a=(await N.ZP.get(`/users/${e}`)).data;if("employee"===a.user_type){let t=await N.ZP.get(`/vouchers/employee/${e}/available`);l({type:"employee_vouchers",user:a,vouchers:t.data.vouchers}),s("redeem-voucher")}else l({type:"loyalty_id",user:a}),s("add-points");G(),K("success")}else throw Error("Unknown QR code type")}catch(t){let e=t.response?.data?.error||t.message||"Invalid QR code";D(e),s("error"),X(),K("error"),P().error(e)}finally{g(!1),Q.current=!1}}},Y=()=>o?Math.floor(parseFloat(o)/100):0,ee=async e=>{if(e.preventDefault(),!n||!o)return;let t=parseFloat(o);if(isNaN(t)||t<=0){P().error("Amount must be a positive number"),X();return}if(t>1e5){P().error("Amount seems unusually high. Please verify."),X();return}if(!u){P().error("Please select an outlet location"),X();return}g(!0);try{let e=await N.L2.earnPoints(n.user.id,t,u);P().success(`${e.data.points_earned} points added successfully!`),G(),K("success"),s("success"),setTimeout(()=>ea(),6e3)}catch(e){P().error(e.response?.data?.error||"Failed to add points"),X(),K("error")}finally{g(!1)}},et=async()=>{if(n){g(!0);try{let e;if("employee_vouchers"===n.type){if(!b){P().error("Please select a voucher to redeem"),X(),g(!1);return}e=b.id}else e=n.voucher.voucher_id;await N.L2.redeemVoucher(n.user.id,e,u),P().success("Voucher redeemed successfully!"),G(),K("success"),s("success"),setTimeout(()=>ea(),6e3)}catch(e){P().error(e.response?.data?.error||"Failed to redeem voucher"),X(),K("error")}finally{g(!1)}}},es=async e=>{if(e.preventDefault(),!Z.trim()){P().error("Please enter customer ID");return}g(!0);try{let e=parseInt(Z.trim(),10);if(isNaN(e))throw Error("Invalid customer ID format");let t=await N.ZP.get(`/users/${e}`);l({type:"loyalty_id",user:t.data}),s("add-points"),G(),K("success"),P().success("Customer found!")}catch(t){let e=t.response?.data?.error||"Customer not found";P().error(e),X(),K("error")}finally{g(!1)}},ea=()=>{s("scan"),l(null),c(""),L(""),y(null),D(""),I(!1),F(null),Q.current=!1};return a.jsx(i.Z,{children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-11 h-11 bg-gradient-to-br from-gray-800 to-gray-900 text-white rounded-full flex items-center justify-center font-bold text-lg shadow-sm",children:H&&e?.name?.charAt(0)}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-semibold text-gray-900 text-base",children:H?e?.name:""}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[a.jsx(_.Z,{className:"w-3.5 h-3.5 text-gray-500"}),a.jsx("span",{className:"text-gray-600",children:H&&(u||e?.branch)||"Not Set"}),a.jsx("span",{className:"w-1 h-1 bg-gray-300 rounded-full"}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[a.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),a.jsx("span",{className:"text-green-700 font-medium text-xs",children:"Active"})]})]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-0.5",children:"Time"}),a.jsx("p",{className:"text-xl font-bold text-gray-900 font-mono tabular-nums",suppressHydrationWarning:!0,children:q?q.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"--:--"})]})]})}),"scan"===t&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Scan Customer QR"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Use camera to scan or enter code manually"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>{z.current?.startScanner()},className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gray-900 text-white rounded-xl font-semibold text-base hover:bg-gray-800 transition-colors shadow-sm",children:[a.jsx(k.Z,{size:24}),"Start Camera Scan"]}),(0,a.jsxs)("button",{type:"button",onClick:()=>{s("manual-entry"),L("")},className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-white border-2 border-gray-300 text-gray-700 rounded-xl font-semibold text-base hover:bg-gray-50 hover:border-gray-400 transition-all",children:[a.jsx(S,{size:24}),"Enter Code Manually"]})]})]}),a.jsx(h,{ref:z,onScan:J}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-xl border border-gray-200 p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:a.jsx(v.Z,{className:"w-5 h-5 text-white"})}),a.jsx("h3",{className:"font-bold text-gray-900",children:"Verification Checklist"})]}),(0,a.jsxs)("ul",{className:"space-y-2.5",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2.5 text-sm text-gray-700",children:[a.jsx(f.Z,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsx("span",{children:"Verify customer identity for high-value vouchers"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2.5 text-sm text-gray-700",children:[a.jsx(f.Z,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsx("span",{children:"Check voucher has not expired (10-minute timer)"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2.5 text-sm text-gray-700",children:[a.jsx(f.Z,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsx("span",{children:"Confirm outlet restrictions match current branch"})]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-xl border border-gray-200 p-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx("div",{className:"w-8 h-8 bg-amber-500 rounded-lg flex items-center justify-center",children:a.jsx(C.Z,{className:"w-5 h-5 text-white"})}),a.jsx("h3",{className:"font-bold text-gray-900",children:"Scanning Tips"})]}),(0,a.jsxs)("ul",{className:"space-y-2 text-sm text-gray-700",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-amber-600 font-bold",children:"•"}),a.jsx("span",{children:"Ask customer to increase screen brightness"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-amber-600 font-bold",children:"•"}),a.jsx("span",{children:"Hold QR code 15–20 cm from camera"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-amber-600 font-bold",children:"•"}),a.jsx("span",{children:"Keep the code centered and steady"})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-amber-600 font-bold",children:"•"}),a.jsx("span",{children:"Use manual entry if scanning fails"})]})]})]})]}),"add-points"===t&&n&&(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx(m.Z,{customer:n.user,qrType:"loyalty_id",showFullDetails:!0}),a.jsx(w,{customerId:n.user.id,pointsBalance:n.user.points_balance,onApplyReward:(e,t)=>{F({id:e,title:t}),I(!0)}}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h3",{className:"text-xl font-bold text-black",children:"Add Points for Purchase"}),a.jsx("button",{onClick:ea,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(d.Z,{size:24})})]}),(0,a.jsxs)("form",{onSubmit:ee,className:"space-y-5",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Purchase Amount (฿) *"}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-lg font-semibold",children:"฿"}),a.jsx("input",{type:"number",step:"0.01",min:"0",className:"w-full pl-12 pr-4 py-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-black focus:border-black text-lg font-semibold",placeholder:"350.00",value:o,onChange:e=>c(e.target.value),required:!0})]}),o&&parseFloat(o)>0&&(0,a.jsxs)("div",{className:"mt-4 bg-gradient-to-br from-amber-50 via-amber-100 to-yellow-50 rounded-xl p-5 border-2 border-amber-300 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-9 h-9 bg-amber-400 rounded-lg flex items-center justify-center shadow-sm",children:a.jsx(E.Z,{className:"w-5 h-5 text-white"})}),a.jsx("span",{className:"font-bold text-base text-amber-900",children:"Points to Award"})]}),a.jsx("div",{className:"bg-white px-4 py-2 rounded-lg border-2 border-amber-400 shadow-sm",children:(0,a.jsxs)("span",{className:"text-2xl font-black text-amber-700",children:["+",Y()]})})]}),(0,a.jsxs)("p",{className:"text-sm text-amber-800 font-medium",children:["Customer earns ",a.jsx("strong",{children:"1 point per ฿100"})," spent"]})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Outlet Location *"}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2",children:a.jsx(R.Z,{className:"w-5 h-5 text-gray-400"})}),(0,a.jsxs)("select",{className:"w-full pl-12 pr-4 py-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-black focus:border-black text-base font-medium appearance-none bg-white",value:u,onChange:e=>x(e.target.value),required:!0,children:[a.jsx("option",{value:"",children:"-- Select Outlet --"}),a.jsx("option",{value:"Sukhumvit",children:"Sarnies Sukhumvit"}),a.jsx("option",{value:"Old Town",children:"Sarnies Old Town"}),a.jsx("option",{value:"Roastery",children:"Sarnies Roastery"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{type:"submit",className:`flex-1 py-4 rounded-xl font-bold transition-all shadow-sm ${p||!o||0>=parseFloat(o)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gray-900 text-white hover:bg-gray-800 hover:shadow-md"}`,disabled:p||!o||0>=parseFloat(o),children:p?"Processing...":o&&parseFloat(o)>0?`Confirm & Add ${Y()} Points`:"Enter Amount to Continue"}),a.jsx("button",{type:"button",onClick:ea,className:"px-6 py-4 border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-50 transition-colors disabled:opacity-50",disabled:p,children:"Cancel"})]})]})]})]}),"redeem-voucher"===t&&n&&("employee_vouchers"===n.type||b)&&(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx(m.Z,{customer:n.user,qrType:"employee_vouchers"===n.type?"loyalty_id":"voucher_redemption",showFullDetails:!1}),"employee_vouchers"===n.type?(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 border border-gray-200",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Employee Benefits Available"}),n.vouchers&&n.vouchers.length>0?a.jsx("div",{className:"space-y-3",children:n.vouchers.map(e=>a.jsx("button",{onClick:()=>{y(e),l({...n,selectedVoucher:e})},disabled:0===e.available_today,className:`w-full text-left p-4 rounded-xl border-2 transition-all ${0===e.available_today?"bg-gray-100 border-gray-300 opacity-60 cursor-not-allowed":b?.id===e.id?"bg-green-50 border-green-500":"bg-white border-gray-200 hover:border-green-400"}`,children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold text-gray-900",children:e.title}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),a.jsx("div",{className:"flex items-center gap-4 mt-2",children:(0,a.jsxs)("span",{className:`text-sm font-medium ${e.available_today>0?"text-green-600":"text-gray-500"}`,children:["Available today: ",e.available_today,"/",e.max_redemptions_per_user_per_day||"∞"]})})]}),0===e.available_today&&a.jsx("span",{className:"px-3 py-1 bg-gray-200 text-gray-700 text-xs font-medium rounded-full",children:"Used Today"}),b?.id===e.id&&a.jsx(f.Z,{className:"w-6 h-6 text-green-600 ml-3"})]})},e.id))}):a.jsx("p",{className:"text-gray-500 text-center py-4",children:"No employee benefits available"}),b&&(0,a.jsxs)("div",{className:"mt-6 flex gap-3",children:[a.jsx("button",{onClick:et,className:"flex-1 bg-green-600 text-white py-4 rounded-xl font-bold hover:bg-green-700 transition-all shadow-sm hover:shadow-md disabled:opacity-50",disabled:p,children:p?"Processing...":"Confirm Redemption"}),a.jsx("button",{onClick:ea,className:"px-6 py-4 border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-50 transition-colors",disabled:p,children:"Cancel"})]})]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(j.Z,{voucher:b,qrExpiry:n.voucher.expires_at,customerPointsAfterRedemption:n.user.points_balance,showFullDetails:!0}),a.jsx("div",{className:"bg-white rounded-2xl shadow-sm p-6 border border-gray-200",children:(0,a.jsxs)("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:et,className:"flex-1 bg-green-600 text-white py-5 rounded-xl font-bold hover:bg-green-700 transition-all shadow-sm hover:shadow-md text-lg disabled:opacity-50",disabled:p,children:p?"Processing...":"Redeem Voucher Now"}),a.jsx("button",{onClick:ea,className:"px-6 py-5 border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-50 transition-colors",disabled:p,children:"Cancel"})]})})]})]}),"success"===t&&(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-12 text-center border-2 border-green-200",children:[a.jsx("div",{className:"w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:a.jsx(f.Z,{size:60,className:"text-green-600"})}),a.jsx("h3",{className:"text-3xl font-bold text-black mb-3",children:"Success!"}),a.jsx("p",{className:"text-gray-600 text-lg mb-8",children:"Transaction completed successfully"}),a.jsx("button",{onClick:ea,className:"bg-black text-white px-8 py-4 rounded-xl font-bold hover:bg-gray-800 transition-all shadow-sm hover:shadow-md",children:"Scan Next Customer"})]}),"error"===t&&(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-12 text-center border-2 border-red-200",children:[a.jsx("div",{className:"w-24 h-24 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:a.jsx(v.Z,{size:60,className:"text-red-600"})}),a.jsx("h3",{className:"text-3xl font-bold text-black mb-3",children:"Scan Failed"}),a.jsx("p",{className:"text-gray-600 text-lg mb-8",children:$}),a.jsx("button",{onClick:ea,className:"bg-black text-white px-8 py-4 rounded-xl font-bold hover:bg-gray-800 transition-all shadow-sm hover:shadow-md",children:"Try Again"})]}),"manual-entry"===t&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center mb-2",children:[a.jsx("h1",{className:"text-h2 text-sarnies-black mb-2",children:"Manual Customer Entry"}),a.jsx("p",{className:"text-sm text-sarnies-midgray",children:"Enter customer ID or phone number"})]}),a.jsx("div",{className:"bg-white rounded-2xl shadow-sm p-6 border border-gray-200",children:(0,a.jsxs)("form",{onSubmit:es,className:"space-y-5",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Customer ID *"}),a.jsx("input",{type:"text",className:"w-full px-4 py-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-black focus:border-black text-lg font-semibold",placeholder:"e.g., 123 or member ID",value:Z,onChange:e=>L(e.target.value),autoFocus:!0,required:!0}),a.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Customer can find their ID in the app under Profile"})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[a.jsx("button",{type:"submit",className:"flex-1 bg-black text-white py-4 rounded-xl font-bold hover:bg-gray-800 transition-all shadow-sm hover:shadow-md disabled:opacity-50",disabled:p||!Z.trim(),children:p?"Searching...":"Find Customer"}),a.jsx("button",{type:"button",onClick:ea,className:"px-6 py-4 border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-50 transition-colors",disabled:p,children:"Cancel"})]})]})})]}),A&&T&&a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 animate-in fade-in zoom-in duration-200",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[a.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg",children:a.jsx(v.Z,{className:"w-8 h-8 text-white"})}),a.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Confirm Reward Application"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Are you sure you want to apply ",a.jsx("strong",{className:"text-gray-900",children:T.title})," to this transaction?"]})]}),a.jsx("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-2xl p-4 mb-6",children:a.jsx("p",{className:"text-sm text-amber-900 font-medium text-center",children:"⚠️ Please confirm with the customer before proceeding"})}),(0,a.jsxs)("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>{I(!1),F(null)},className:"flex-1 py-3 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-bold transition-colors",children:"Cancel"}),a.jsx("button",{onClick:()=>{T&&(P().success(`${T.title} applied to transaction!`),G(),K("success"),I(!1),F(null))},className:"flex-1 py-3 px-4 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-xl font-bold shadow-lg shadow-green-500/30 transition-all",children:"Confirm & Apply"})]})]})})]})})}},99048:(e,t,s)=>{"use strict";s.d(t,{Z:()=>m});var a=s(10326),r=s(17577),i=s(46226),n=s(48998),l=s(71821),o=s(997),d=s(77636),c=s(87888),h=s(54659);function m({voucher:e,qrExpiry:t,customerPointsAfterRedemption:s,showFullDetails:m=!0}){let[u,x]=(0,r.useState)(null),[p,g]=(0,r.useState)(!1);return(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border-2 border-gray-200 overflow-hidden",children:[t&&a.jsx("div",{className:`${p?"bg-red-600":u&&u<120?"bg-orange-600":"bg-green-600"} text-white px-5 py-2.5`,children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(n.Z,{className:"w-4 h-4"}),a.jsx("span",{className:"font-semibold text-sm",children:p?"QR CODE EXPIRED":"QR Code Expires In"})]}),!p&&null!==u&&a.jsx("span",{className:"text-xl font-bold font-mono",children:`${Math.floor(u/60)}:${(u%60).toString().padStart(2,"0")}`})]})}),e.image_url&&a.jsx("div",{className:"relative aspect-[16/9] bg-gray-100",children:a.jsx(i.default,{src:e.image_url,alt:e.title,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, 600px"})}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-2xl font-bold text-black mb-2",children:e.title}),a.jsx("p",{className:"text-gray-600 leading-relaxed",children:e.description})]}),a.jsx("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 text-xs font-bold rounded-full whitespace-nowrap",children:(()=>{switch(e.voucher_type){case"free_item":return"Free Item";case"discount_amount":return"Discount";case"percentage_discount":return"Percentage Off";case"merch":return"Merchandise";default:return"Reward"}})()})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(l.Z,{className:"w-4 h-4 text-green-700"}),a.jsx("p",{className:"text-xs font-medium text-green-700",children:"Cash Value"})]}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-green-800",children:["฿",Number(e.cash_value).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl p-4 border border-amber-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(o.Z,{className:"w-4 h-4 text-amber-700"}),a.jsx("p",{className:"text-xs font-medium text-amber-700",children:"Points Cost"})]}),a.jsx("p",{className:"text-3xl font-bold text-amber-800",children:e.points_required})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(d.Z,{className:"w-4 h-4 text-gray-600"}),a.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Valid Locations"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:(e.locations?e.locations.split(",").map(e=>e.trim().toUpperCase()):["ALL LOCATIONS"]).map((e,t)=>a.jsx("span",{className:"px-3 py-1.5 bg-blue-100 text-blue-800 text-xs font-bold rounded-full border border-blue-200",children:e},t))})]}),m&&(0,a.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-gray-50 rounded-lg",children:[a.jsx(c.Z,{className:"w-4 h-4 text-gray-600 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Expiry Policy"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["no_expiry"===e.expiry_type&&"This voucher has no expiry date","days_after_redeem"===e.expiry_type&&e.expiry_days&&`Valid for ${e.expiry_days} days after redemption`,"fixed_date"===e.expiry_type&&"Limited time offer - check specific date"]})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[a.jsx(h.Z,{className:"w-4 h-4 text-amber-700 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-bold text-amber-900",children:"One-Time Use Only"}),a.jsx("p",{className:"text-sm text-amber-800",children:"This voucher can only be redeemed once"})]})]}),void 0!==s&&(0,a.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[a.jsx(o.Z,{className:"w-4 h-4 text-blue-700 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Customer Remaining Points"}),(0,a.jsxs)("p",{className:"text-lg font-bold text-blue-700",children:[s," points"]})]})]})]})]})]})}},72257:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},51896:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},48998:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},85567:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]])},71821:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},25276:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]])},1572:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]])},33734:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]])},22915:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(76557).Z)("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]])},33439:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(68570).createProxy)(String.raw`/root/Loyalty/frontend/app/staff/scan/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[5380,2696,4464,6226,5814,4810],()=>s(42163));module.exports=a})();