(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7937],{6727:function(e,t,s){Promise.resolve().then(s.bind(s,4652))},4652:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var n=s(7437),a=s(2265),r=s(9376),o=s(2097),i=s(9116);function c(){let e=(0,r.useRouter)(),t=(0,r.useSearchParams)(),{setAuth:s}=(0,o.t)(),[c,l]=(0,a.useState)("loading"),[u,d]=(0,a.useState)("");return(0,a.useEffect)(()=>{(async()=>{let n=t.get("token");if(!n){l("error"),d("No token provided");return}try{let{token:t,user:a}=(await i.ZP.get("/auth/magic-link/verify/".concat(n))).data;s(a,t),l("success"),setTimeout(()=>{e.push("/app/home")},1500)}catch(e){var a,r;l("error"),d((null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.error)||"Failed to verify link")}})()},[t,s,e]),(0,n.jsx)("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center p-4",children:(0,n.jsx)("div",{className:"w-full max-w-md",children:(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-8 text-center",children:["loading"===c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-12 h-12 border-4 border-neutral-200 border-t-neutral-900 rounded-full animate-spin mx-auto mb-4"}),(0,n.jsx)("h1",{className:"text-xl font-semibold text-neutral-900 mb-2",children:"Verifying..."}),(0,n.jsx)("p",{className:"text-neutral-500",children:"Please wait while we sign you in"})]}),"success"===c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,n.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,n.jsx)("h1",{className:"text-xl font-semibold text-neutral-900 mb-2",children:"Welcome!"}),(0,n.jsx)("p",{className:"text-neutral-500",children:"You're signed in. Redirecting..."})]}),"error"===c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,n.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,n.jsx)("h1",{className:"text-xl font-semibold text-neutral-900 mb-2",children:"Link Invalid"}),(0,n.jsx)("p",{className:"text-neutral-500 mb-6",children:u||"This link has expired or already been used."}),(0,n.jsx)("button",{onClick:()=>e.push("/login"),className:"w-full bg-neutral-900 text-white py-3 rounded-xl font-medium hover:bg-neutral-800 transition-colors",children:"Back to Login"})]})]})})})}function l(){return(0,n.jsx)("div",{className:"min-h-screen bg-neutral-50 flex items-center justify-center p-4",children:(0,n.jsx)("div",{className:"w-full max-w-md",children:(0,n.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-8 text-center",children:[(0,n.jsx)("div",{className:"w-12 h-12 border-4 border-neutral-200 border-t-neutral-900 rounded-full animate-spin mx-auto mb-4"}),(0,n.jsx)("h1",{className:"text-xl font-semibold text-neutral-900 mb-2",children:"Loading..."})]})})})}function u(){return(0,n.jsx)(a.Suspense,{fallback:(0,n.jsx)(l,{}),children:(0,n.jsx)(c,{})})}},9116:function(e,t,s){"use strict";s.d(t,{L2:function(){return i},Vj:function(){return l},Z1:function(){return m},cC:function(){return g},h3:function(){return r},hO:function(){return o},kv:function(){return a},nN:function(){return u},oZ:function(){return c},w2:function(){return d},xf:function(){return p}});let n=s(3464).Z.create({baseURL:"https://loyalty.sarnies.tech/api",headers:{"Content-Type":"application/json"},withCredentials:!0});n.interceptors.request.use(e=>{{let t=localStorage.getItem("auth-storage");if(t)try{let{state:s}=JSON.parse(t);(null==s?void 0:s.token)&&(e.headers.Authorization="Bearer ".concat(s.token))}catch(e){}}return e}),n.interceptors.response.use(e=>e,e=>{var t,s,n;if((null===(t=e.response)||void 0===t?void 0:t.status)===401){let t=window.location.pathname.includes("/login"),a=null===(n=e.config)||void 0===n?void 0:null===(s=n.url)||void 0===s?void 0:s.includes("/auth/"),r=localStorage.getItem("auth-storage");t||a||!r||(localStorage.removeItem("auth-storage"),window.location.href="/login")}return Promise.reject(e)}),t.ZP=n;let a={staffLogin:(e,t)=>n.post("/auth/login",{email:e,password:t}),sendOTP:e=>n.post("/auth/otp/send",{phone:e}),verifyOTP:(e,t)=>n.post("/auth/otp/verify",{phone:e,otp:t}),sendEmailOTP:e=>n.post("/auth/otp/email/send",{email:e}),verifyEmailOTP:(e,t)=>n.post("/auth/otp/email/verify",{email:e,otp:t}),sendMagicLink:e=>n.post("/auth/magic-link/send",{email:e}),verifyMagicLink:e=>n.get("/auth/magic-link/verify/".concat(e))},r={getAll:e=>n.get("/users",{params:e}),getOne:e=>n.get("/users/".concat(e)),update:(e,t)=>n.put("/users/".concat(e),t),adjustPoints:(e,t,s)=>n.post("/users/".concat(e,"/points"),{points:t,reason:s}),getStaticQR:e=>n.get("/users/".concat(e,"/static-qr")),getVoucherInstances:(e,t)=>n.get("/users/".concat(e,"/voucher-instances"),{params:t?{status:t}:void 0})},o={getAll:()=>n.get("/vouchers"),getAllAdmin:()=>n.get("/vouchers/all"),getOne:e=>n.get("/vouchers/".concat(e)),create:e=>n.post("/vouchers",e),update:(e,t)=>n.patch("/vouchers/".concat(e),t),delete:e=>n.delete("/vouchers/".concat(e)),redeem:(e,t)=>n.post("/vouchers/".concat(e,"/redeem"),{user_id:t}),getInstances:(e,t)=>n.get("/vouchers/instances/".concat(e),{params:{status:t}})},i={earnPoints:(e,t,s)=>n.post("/transactions/earn",{user_id:e,amount:t,outlet:s}),redeemVoucher:(e,t,s)=>n.post("/transactions/redeem",{user_id:e,voucher_id:t,outlet:s}),getAll:e=>n.get("/transactions",{params:e})},c={getAll:e=>n.get("/announcements",{params:{user_type:e}}),getAllAdmin:()=>n.get("/announcements/all"),getById:e=>n.get("/announcements/".concat(e)),create:e=>n.post("/announcements",e),update:(e,t)=>n.patch("/announcements/".concat(e),t),delete:e=>n.delete("/announcements/".concat(e))},l={getCredits:()=>n.get("/investors/credits"),getOutletCredits:e=>n.get("/investors/credits/outlet/".concat(e)),getTransactions:e=>n.get("/investors/transactions",{params:e}),allocateOutletCredits:(e,t)=>n.post("/investors/admin/".concat(e,"/outlet-credits"),t),allocateGroupCredits:(e,t)=>n.post("/investors/admin/".concat(e,"/group-credits"),t),adjustCredits:(e,t)=>n.patch("/investors/admin/".concat(e,"/credits/adjust"),t),getExpiringCredits:e=>n.get("/investors/admin/credits/expiring",{params:e?{days:e}:void 0})},u={getBudget:()=>n.get("/media/budget"),getTransactions:e=>n.get("/media/transactions",{params:e}),setBudget:(e,t)=>n.post("/media/admin/".concat(e,"/budget"),t),adjustBudget:(e,t)=>n.patch("/media/admin/".concat(e,"/budget/adjust"),t),getExpiringBudgets:e=>n.get("/media/admin/budgets/expiring",{params:e?{days:e}:void 0}),getUsageReport:()=>n.get("/media/admin/usage-report")},d={getAll:()=>n.get("/settings"),getOne:e=>n.get("/settings/".concat(e)),update:(e,t)=>n.put("/settings/".concat(e),{value:t}),bulkUpdate:e=>n.put("/settings",{settings:e}),create:e=>n.post("/settings",e)},g={getVapidKey:()=>n.get("/notifications/vapid-public-key"),subscribe:e=>n.post("/notifications/subscribe",{subscription:e.toJSON()}),unsubscribe:e=>n.post("/notifications/unsubscribe",{endpoint:e}),getStatus:()=>n.get("/notifications/status"),getPreferences:()=>n.get("/notifications/preferences"),updatePreferences:e=>n.patch("/notifications/preferences",{preferences:e}),sendTest:()=>n.post("/notifications/test"),getHistory:e=>n.get("/notifications/history",{params:e}),adminSend:e=>n.post("/notifications/admin/send",e),adminBroadcast:e=>n.post("/notifications/admin/broadcast",e),adminStats:()=>n.get("/notifications/admin/stats"),adminProcessQueue:()=>n.post("/notifications/admin/process-queue")},m={getMyCode:()=>n.get("/referrals/my-code"),getMyReferrals:()=>n.get("/referrals/my-referrals"),validateCode:e=>n.get("/referrals/validate/".concat(e)),applyCode:e=>n.post("/referrals/apply",e),getAdminStats:()=>n.get("/referrals/admin/stats")},p={getAll:()=>n.get("/pos/keys"),create:e=>n.post("/pos/keys",e),revoke:e=>n.delete("/pos/keys/".concat(e)),getLogs:(e,t)=>n.get("/pos/keys/".concat(e,"/logs"),{params:t}),getStats:()=>n.get("/pos/keys/stats")}},2097:function(e,t,s){"use strict";s.d(t,{t:function(){return r}});var n=s(9625),a=s(6885);let r=(0,n.Ue)()((0,a.tJ)(e=>({user:null,token:null,hasHydrated:!1,setAuth:(t,s)=>{e({user:t,token:s})},logout:()=>{e({user:null,token:null})},updateUser:t=>{e(e=>e.user?{user:{...e.user,...t}}:e)},setHasHydrated:t=>{e({hasHydrated:t})}}),{name:"auth-storage",storage:(0,a.FL)(()=>localStorage),onRehydrateStorage:()=>e=>{null==e||e.setHasHydrated(!0)}}))}},function(e){e.O(0,[1299,3464,2971,2117,1744],function(){return e(e.s=6727)}),_N_E=e.O()}]);