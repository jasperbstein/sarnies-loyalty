(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2719],{2886:function(e,s,t){Promise.resolve().then(t.bind(t,202))},202:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return A}});var r=t(7437),a=t(2265),l=t(6189),n=t(1197),i=t(7015),o=t(2489),d=t(6324);let c=(0,a.forwardRef)((e,s)=>{var t;let{onScan:l}=e,[c,m]=(0,a.useState)(""),[x,u]=(0,a.useState)(!1),[h,b]=(0,a.useState)(""),[g,p]=(0,a.useState)(!1),[f,y]=(0,a.useState)([]),[v,j]=(0,a.useState)(""),N=(0,a.useRef)(null),w=(0,a.useRef)(!1),k=(0,a.useRef)(null),C=async e=>{try{var s,t;if(b(""),w.current=!1,!(null===(t=navigator)||void 0===t?void 0:null===(s=t.mediaDevices)||void 0===s?void 0:s.getUserMedia))throw Error("Camera API not supported in this browser. Please use a modern browser like Chrome or Safari.");try{await navigator.mediaDevices.getUserMedia({video:!0})}catch(e){if("NotAllowedError"===e.name||"PermissionDeniedError"===e.name)throw Error("PERMISSION_DENIED");throw e}if(!await d.Z.hasCamera())throw Error("NO_CAMERA");let r=await d.Z.listCameras(!0);if(!r||0===r.length)throw Error("NO_CAMERA");if(y(r),u(!0),await new Promise(e=>setTimeout(e,300)),!k.current)throw Error("Video element not ready. Please try again.");let a=e||v;if(!a){let e=r.find(e=>e.label.toLowerCase().includes("back")||e.label.toLowerCase().includes("rear")||e.label.toLowerCase().includes("environment"));a=(null==e?void 0:e.id)||r[r.length-1].id,j(a)}let n=new d.Z(k.current,e=>{w.current||(w.current=!0,p(!0),setTimeout(()=>{l(e.data),Z()},500))},{returnDetailedScanResult:!0,highlightScanRegion:!0,highlightCodeOutline:!0,preferredCamera:a,maxScansPerSecond:10});N.current=n,a&&await n.setCamera(a),await n.start()}catch(t){let e="Failed to start camera.",s=String(t);"PERMISSION_DENIED"===t.message||s.includes("NotAllowed")||s.includes("Permission")?e="Camera permission denied. Please allow camera access and try again.":"NO_CAMERA"===t.message||s.includes("NotFound")?e="No camera found on this device.":s.includes("NotReadable")||s.includes("in use")?e="Camera is already in use by another app.":t.message&&"PERMISSION_DENIED"!==t.message&&"NO_CAMERA"!==t.message&&(e=t.message),b(e),u(!1)}},_=async()=>{if(f.length<=1)return;let e=(f.findIndex(e=>e.id===v)+1)%f.length,s=f[e];if(N.current)try{await N.current.setCamera(s.id),j(s.id)}catch(e){await Z(),await C(s.id)}},Z=async()=>{if(N.current)try{N.current.stop(),N.current.destroy(),N.current=null}catch(e){}u(!1),p(!1)};return(0,a.useImperativeHandle)(s,()=>({startScanner:()=>{x||C()}})),(0,a.useEffect)(()=>(x?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow="",N.current&&Z()}),[x]),(0,r.jsx)(r.Fragment,{children:x?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 bg-black",children:[(0,r.jsx)("video",{ref:k,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0,muted:!0,style:{transform:"scaleX(1)"}}),(0,r.jsx)("div",{className:"absolute top-0 left-0 right-0 bg-gradient-to-b from-black/80 to-transparent p-4 z-10",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(n.Z,{className:"w-6 h-6 text-yellow-400",strokeWidth:2}),(0,r.jsx)("h3",{className:"text-white font-bold text-lg",children:"Scan QR Code"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[f.length>1&&(0,r.jsx)("button",{onClick:_,className:"p-3 bg-white/20 backdrop-blur-sm text-white rounded-full hover:bg-white/30 transition-colors",title:"Switch Camera",children:(0,r.jsx)(i.Z,{size:24})}),(0,r.jsx)("button",{onClick:Z,className:"p-3 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors",title:"Close Camera",children:(0,r.jsx)(o.Z,{size:24})})]})]})}),!g&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-5",children:(0,r.jsxs)("div",{className:"relative w-72 h-72",children:[(0,r.jsx)("div",{className:"absolute -top-2 -left-2 w-16 h-16 border-l-4 border-t-4 border-yellow-400 rounded-tl-2xl"}),(0,r.jsx)("div",{className:"absolute -top-2 -right-2 w-16 h-16 border-r-4 border-t-4 border-yellow-400 rounded-tr-2xl"}),(0,r.jsx)("div",{className:"absolute -bottom-2 -left-2 w-16 h-16 border-l-4 border-b-4 border-yellow-400 rounded-bl-2xl"}),(0,r.jsx)("div",{className:"absolute -bottom-2 -right-2 w-16 h-16 border-r-4 border-b-4 border-yellow-400 rounded-br-2xl"}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)("div",{className:"bg-black/50 backdrop-blur-sm p-4 rounded-2xl",children:(0,r.jsx)(n.Z,{className:"w-12 h-12 text-yellow-400 animate-pulse",strokeWidth:2})})})]})}),(0,r.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-6 z-10",children:[g?(0,r.jsxs)("div",{className:"bg-yellow-500 text-black px-6 py-4 rounded-xl text-center font-semibold shadow-lg flex items-center justify-center gap-2",children:[(0,r.jsx)(n.Z,{className:"w-5 h-5",strokeWidth:2.5}),(0,r.jsx)("span",{children:"QR Recognized — Loading..."})]}):(0,r.jsxs)("div",{className:"bg-white/20 backdrop-blur-sm text-white px-6 py-4 rounded-xl text-center",children:[(0,r.jsx)("p",{className:"font-medium",children:"Hold QR code steady inside the frame"}),(0,r.jsx)("p",{className:"text-sm text-white/80 mt-1",children:"Position 15-20cm from camera"})]}),f.length>1&&v&&(0,r.jsxs)("p",{className:"text-white/60 text-xs text-center mt-3",children:["Current: ",(null===(t=f.find(e=>e.id===v))||void 0===t?void 0:t.label)||"Unknown Camera"]})]}),g&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-20",children:(0,r.jsxs)("div",{className:"relative w-80 h-80",children:[(0,r.jsx)("div",{className:"absolute inset-0 border-4 border-yellow-400 rounded-2xl animate-pulse",style:{boxShadow:"0 0 40px rgba(250, 204, 21, 0.8)"}}),(0,r.jsx)("div",{className:"absolute -top-2 -left-2 w-16 h-16 border-l-4 border-t-4 border-yellow-300 rounded-tl-2xl"}),(0,r.jsx)("div",{className:"absolute -top-2 -right-2 w-16 h-16 border-r-4 border-t-4 border-yellow-300 rounded-tr-2xl"}),(0,r.jsx)("div",{className:"absolute -bottom-2 -left-2 w-16 h-16 border-l-4 border-b-4 border-yellow-300 rounded-bl-2xl"}),(0,r.jsx)("div",{className:"absolute -bottom-2 -right-2 w-16 h-16 border-r-4 border-b-4 border-yellow-300 rounded-br-2xl"}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"bg-yellow-500 text-black rounded-full p-6 shadow-2xl relative",children:[(0,r.jsx)(n.Z,{className:"w-16 h-16",strokeWidth:2.5}),(0,r.jsx)("div",{className:"absolute -bottom-2 -right-2 bg-green-500 text-white rounded-full p-2 shadow-lg border-4 border-white",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]})})]})})]}):h&&(0,r.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg mb-4",children:(0,r.jsx)("p",{className:"text-sm text-red-800",children:h})})})});c.displayName="QRScanner";var m=t(6943),x=t(9089),u=t(8166),h=t(6595),b=t(2023),g=t(7414),p=t(1723),f=t(5302),y=t(2252);function v(e){let{customerId:s,pointsBalance:t,onApplyReward:l}=e,[i,o]=(0,a.useState)(null),d=[{id:1,type:"voucher",title:"Free Coffee",description:"Any size hot coffee",value:"฿150",status:"available",isExpiring:!0,expiresAt:"Today at 11:59 PM",eligibilityReason:"Daily staff voucher"},{id:2,type:"employee_perk",title:"Staff Discount",description:"All menu items",value:"20% OFF",status:"available",discountValue:"20%",eligibilityReason:"Employee benefit"},{id:3,type:"free_item",title:"Free Pastry",description:"Any pastry from display",value:"25 pts",pointsCost:25,status:t>=25?"available":"expired",eligibilityReason:t>=25?"Earned reward":"Need ".concat(25-t," more points")},{id:4,type:"partner_perk",title:"Partner Discount",description:"Valid at all branches",value:"15% OFF",status:"available",discountValue:"15%",eligibilityReason:"Partner program member"}].filter(e=>"expired"!==e.status||e.pointsCost),c=e=>{switch(e){case"voucher":return n.Z;case"discount":case"employee_perk":case"partner_perk":return x.Z;case"free_item":return u.Z;case"points":return h.Z;case"vip_perk":return b.Z;default:return g.Z}},m=e=>"expired"===e.status?"bg-gray-50 border-gray-200 opacity-60":e.isExpiring?"bg-gradient-to-br from-orange-50 to-amber-50 border-orange-200 shadow-sm":"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200 shadow-sm",v=e=>{switch(e){case"voucher":return"bg-gradient-to-br from-green-500 to-green-600";case"employee_perk":return"bg-gradient-to-br from-blue-500 to-blue-600";case"partner_perk":return"bg-gradient-to-br from-purple-500 to-purple-600";case"free_item":return"bg-gradient-to-br from-amber-500 to-amber-600";case"vip_perk":return"bg-gradient-to-br from-orange-500 to-orange-600";default:return"bg-gradient-to-br from-gray-500 to-gray-600"}},j=e=>{"available"===e.status&&(o(e.id),setTimeout(()=>{l&&l(e.id,e.title),o(null)},500))};return 0===d.length?(0,r.jsxs)("div",{className:"bg-white rounded-2xl p-8 border border-gray-200 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-6",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center",children:(0,r.jsx)(g.Z,{className:"w-5 h-5 text-gray-600"})}),(0,r.jsx)("h3",{className:"font-bold text-xl text-gray-900",children:"Eligible Rewards & Discounts"})]}),(0,r.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-xl border border-gray-200",children:[(0,r.jsx)(g.Z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-500 font-medium",children:"No eligible rewards at this time"}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Check back after customer earns more points"})]})]}):(0,r.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-5",children:[(0,r.jsx)("div",{className:"w-9 h-9 bg-green-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(g.Z,{className:"w-5 h-5 text-green-700"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"font-bold text-lg text-gray-900",children:"Eligible Rewards & Discounts"}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-0.5",children:[d.length," reward",1!==d.length?"s":""," available"]})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:d.map(e=>{let s=c(e.type),t="available"===e.status,a=i===e.id;return(0,r.jsxs)("div",{className:"relative rounded-xl border-2 p-4 transition-all ".concat(m(e)," ").concat(t&&!a?"hover:shadow-md hover:scale-[1.02]":""),children:[e.isExpiring&&(0,r.jsx)("div",{className:"absolute top-2.5 right-2.5",children:(0,r.jsxs)("span",{className:"flex items-center gap-1 px-2 py-1 bg-orange-500 text-white text-[10px] font-bold rounded-full shadow-sm",children:[(0,r.jsx)(p.Z,{className:"w-3 h-3"}),e.expiresAt]})}),(0,r.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,r.jsx)("div",{className:"w-12 h-12 ".concat(v(e.type)," rounded-xl flex items-center justify-center flex-shrink-0 shadow-md"),children:(0,r.jsx)(s,{className:"w-6 h-6 text-white"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0 pt-0.5",children:[(0,r.jsx)("h4",{className:"font-bold text-base text-gray-900 leading-tight mb-1",children:e.title}),(0,r.jsx)("p",{className:"text-xs text-gray-600 leading-snug",children:e.description})]})]}),(0,r.jsx)("div",{className:"mb-3",children:(0,r.jsx)("span",{className:"inline-block px-3 py-1.5 bg-white border-2 border-gray-900 rounded-lg font-black text-lg text-gray-900 shadow-sm",children:e.value})}),(0,r.jsxs)("div",{className:"mb-3 flex items-start gap-2",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),(0,r.jsx)("p",{className:"text-xs text-gray-700 font-medium leading-snug",children:e.eligibilityReason})]}),(0,r.jsx)("button",{onClick:()=>j(e),disabled:!t||a,className:"w-full py-2.5 rounded-lg font-bold text-sm transition-all ".concat(t?"bg-gray-900 text-white hover:bg-gray-800 shadow-sm hover:shadow-md":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:a?"Applying...":t?"Apply Reward":"Not Available"})]},e.id)})}),(0,r.jsx)("div",{className:"mt-5 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(y.Z,{className:"w-5 h-5 text-blue-700 flex-shrink-0 mt-0.5"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm text-blue-900 font-semibold",children:"Staff Tip"}),(0,r.jsx)("p",{className:"text-sm text-blue-700 mt-0.5 leading-snug",children:'Click "Apply Reward" to apply a discount or voucher to the current transaction. Confirm with the customer before applying.'})]})]})})]})}var j=t(6469),N=t(9116),w=t(3774),k=t(3581),C=t(2207),_=t(3245),Z=t(3618),S=t(4413),P=t(9064),E=t(4474),R=t(2097);function A(){var e;let{user:s}=(0,R.t)(),[t,n]=(0,a.useState)("scan"),[i,d]=(0,a.useState)(null),[x,u]=(0,a.useState)(""),[h,b]=(0,a.useState)(""),[g,p]=(0,a.useState)(!1),[A,I]=(0,a.useState)(null),[D,F]=(0,a.useState)(""),[O,T]=(0,a.useState)(""),[z,M]=(0,a.useState)(!1),[L,V]=(0,a.useState)(null),[Q,U]=(0,a.useState)(null),[q,W]=(0,a.useState)(!1),H=(0,a.useRef)(null);(0,a.useEffect)(()=>{W(!0),(null==s?void 0:s.branch)&&b(s.branch)},[null==s?void 0:s.branch]),(0,a.useEffect)(()=>{U(new Date);let e=setInterval(()=>U(new Date),1e3);return()=>clearInterval(e)},[]);let B=(0,a.useRef)(!1),G=(0,a.useRef)(null);(0,a.useEffect)(()=>()=>{G.current&&(G.current.close(),G.current=null)},[]);let X=()=>(!G.current&&"AudioContext"in window&&(G.current=new window.AudioContext),G.current),J=()=>{let e=X();if(e){let s=e.createOscillator(),t=e.createGain();s.connect(t),t.connect(e.destination),s.frequency.value=800,s.type="sine",t.gain.value=.3,s.start(),setTimeout(()=>s.stop(),100)}},K=()=>{let e=X();if(e){let s=e.createOscillator(),t=e.createGain();s.connect(t),t.connect(e.destination),s.frequency.value=300,s.type="sawtooth",t.gain.value=.3,s.start(),setTimeout(()=>s.stop(),200)}},Y=e=>{"vibrate"in navigator&&("success"===e?navigator.vibrate(100):navigator.vibrate([100,50,100]))},$=async e=>{if(e&&!(e.trim().length<10)&&!B.current){B.current=!0,p(!0),F("");try{let s;let t=!1;try{s=JSON.parse(e)}catch(r){try{s=(0,E.o)(e),t=!0}catch(e){throw Error("Invalid QR code format")}}if("voucher_redemption"===s.type){let e=await N.ZP.get("/users/".concat(s.customer_id)),t=await N.ZP.get("/vouchers/".concat(s.voucher_id));d({type:"voucher_redemption",user:e.data,voucher:s}),I(t.data),n("redeem-voucher"),J(),Y("success")}else if("loyalty_id"===s.type||t){let e=s.id||s.customer_id||s.userId;if(!e)throw Error("Customer ID not found in QR code");"string"==typeof e&&(e=parseInt(e,10));let t=(await N.ZP.get("/users/".concat(e))).data;if("employee"===t.user_type){let s=await N.ZP.get("/vouchers/employee/".concat(e,"/available"));d({type:"employee_vouchers",user:t,vouchers:s.data.vouchers}),n("redeem-voucher")}else d({type:"loyalty_id",user:t}),n("add-points");J(),Y("success")}else throw Error("Unknown QR code type")}catch(r){var s,t;let e=(null===(t=r.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.error)||r.message||"Invalid QR code";F(e),n("error"),K(),Y("error"),P.ZP.error(e)}finally{p(!1),B.current=!1}}},ee=()=>x?Math.floor(parseFloat(x)/100):0,es=async e=>{if(e.preventDefault(),!i||!x)return;let s=parseFloat(x);if(isNaN(s)||s<=0){P.ZP.error("Amount must be a positive number"),K();return}if(s>1e5){P.ZP.error("Amount seems unusually high. Please verify."),K();return}if(!h){P.ZP.error("Please select an outlet location"),K();return}p(!0);try{let e=await N.L2.earnPoints(i.user.id,s,h);P.ZP.success("".concat(e.data.points_earned," points added successfully!")),J(),Y("success"),n("success"),setTimeout(()=>ea(),6e3)}catch(e){var t,r;P.ZP.error((null===(r=e.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.error)||"Failed to add points"),K(),Y("error")}finally{p(!1)}},et=async()=>{if(i){p(!0);try{let e;if("employee_vouchers"===i.type){if(!A){P.ZP.error("Please select a voucher to redeem"),K(),p(!1);return}e=A.id}else e=i.voucher.voucher_id;await N.L2.redeemVoucher(i.user.id,e,h),P.ZP.success("Voucher redeemed successfully!"),J(),Y("success"),n("success"),setTimeout(()=>ea(),6e3)}catch(t){var e,s;P.ZP.error((null===(s=t.response)||void 0===s?void 0:null===(e=s.data)||void 0===e?void 0:e.error)||"Failed to redeem voucher"),K(),Y("error")}finally{p(!1)}}},er=async e=>{if(e.preventDefault(),!O.trim()){P.ZP.error("Please enter customer ID");return}p(!0);try{let e=parseInt(O.trim(),10);if(isNaN(e))throw Error("Invalid customer ID format");let s=await N.ZP.get("/users/".concat(e));d({type:"loyalty_id",user:s.data}),n("add-points"),J(),Y("success"),P.ZP.success("Customer found!")}catch(r){var s,t;let e=(null===(t=r.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.error)||"Customer not found";P.ZP.error(e),K(),Y("error")}finally{p(!1)}},ea=()=>{n("scan"),d(null),u(""),T(""),I(null),F(""),M(!1),V(null),B.current=!1};return(0,r.jsx)(l.Z,{children:(0,r.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-11 h-11 bg-gradient-to-br from-gray-800 to-gray-900 text-white rounded-full flex items-center justify-center font-bold text-lg shadow-sm",children:q&&(null==s?void 0:null===(e=s.name)||void 0===e?void 0:e.charAt(0))}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-gray-900 text-base",children:q?null==s?void 0:s.name:""}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,r.jsx)(w.Z,{className:"w-3.5 h-3.5 text-gray-500"}),(0,r.jsx)("span",{className:"text-gray-600",children:q&&(h||(null==s?void 0:s.branch))||"Not Set"}),(0,r.jsx)("span",{className:"w-1 h-1 bg-gray-300 rounded-full"}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,r.jsx)("span",{className:"text-green-700 font-medium text-xs",children:"Active"})]})]})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-0.5",children:"Time"}),(0,r.jsx)("p",{className:"text-xl font-bold text-gray-900 font-mono tabular-nums",suppressHydrationWarning:!0,children:Q?Q.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):"--:--"})]})]})}),"scan"===t&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-1",children:"Scan Customer QR"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Use camera to scan or enter code manually"})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>{var e;null===(e=H.current)||void 0===e||e.startScanner()},className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gray-900 text-white rounded-xl font-semibold text-base hover:bg-gray-800 transition-colors shadow-sm",children:[(0,r.jsx)(k.Z,{size:24}),"Start Camera Scan"]}),(0,r.jsxs)("button",{type:"button",onClick:()=>{n("manual-entry"),T("")},className:"w-full flex items-center justify-center gap-3 px-6 py-4 bg-white border-2 border-gray-300 text-gray-700 rounded-xl font-semibold text-base hover:bg-gray-50 hover:border-gray-400 transition-all",children:[(0,r.jsx)(C.Z,{size:24}),"Enter Code Manually"]})]})]}),(0,r.jsx)(c,{ref:H,onScan:$}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-xl border border-gray-200 p-5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:(0,r.jsx)(y.Z,{className:"w-5 h-5 text-white"})}),(0,r.jsx)("h3",{className:"font-bold text-gray-900",children:"Verification Checklist"})]}),(0,r.jsxs)("ul",{className:"space-y-2.5",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2.5 text-sm text-gray-700",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),(0,r.jsx)("span",{children:"Verify customer identity for high-value vouchers"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2.5 text-sm text-gray-700",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),(0,r.jsx)("span",{children:"Check voucher has not expired (10-minute timer)"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2.5 text-sm text-gray-700",children:[(0,r.jsx)(f.Z,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),(0,r.jsx)("span",{children:"Confirm outlet restrictions match current branch"})]})]})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-xl border border-gray-200 p-5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-amber-500 rounded-lg flex items-center justify-center",children:(0,r.jsx)(_.Z,{className:"w-5 h-5 text-white"})}),(0,r.jsx)("h3",{className:"font-bold text-gray-900",children:"Scanning Tips"})]}),(0,r.jsxs)("ul",{className:"space-y-2 text-sm text-gray-700",children:[(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-amber-600 font-bold",children:"•"}),(0,r.jsx)("span",{children:"Ask customer to increase screen brightness"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-amber-600 font-bold",children:"•"}),(0,r.jsx)("span",{children:"Hold QR code 15–20 cm from camera"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-amber-600 font-bold",children:"•"}),(0,r.jsx)("span",{children:"Keep the code centered and steady"})]}),(0,r.jsxs)("li",{className:"flex items-start gap-2",children:[(0,r.jsx)("span",{className:"text-amber-600 font-bold",children:"•"}),(0,r.jsx)("span",{children:"Use manual entry if scanning fails"})]})]})]})]}),"add-points"===t&&i&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(m.Z,{customer:i.user,qrType:"loyalty_id",showFullDetails:!0}),(0,r.jsx)(v,{customerId:i.user.id,pointsBalance:i.user.points_balance,onApplyReward:(e,s)=>{V({id:e,title:s}),M(!0)}}),(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 border border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-black",children:"Add Points for Purchase"}),(0,r.jsx)("button",{onClick:ea,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(o.Z,{size:24})})]}),(0,r.jsxs)("form",{onSubmit:es,className:"space-y-5",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Purchase Amount (฿) *"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-lg font-semibold",children:"฿"}),(0,r.jsx)("input",{type:"number",step:"0.01",min:"0",className:"w-full pl-12 pr-4 py-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-black focus:border-black text-lg font-semibold",placeholder:"350.00",value:x,onChange:e=>u(e.target.value),required:!0})]}),x&&parseFloat(x)>0&&(0,r.jsxs)("div",{className:"mt-4 bg-gradient-to-br from-amber-50 via-amber-100 to-yellow-50 rounded-xl p-5 border-2 border-amber-300 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-9 h-9 bg-amber-400 rounded-lg flex items-center justify-center shadow-sm",children:(0,r.jsx)(Z.Z,{className:"w-5 h-5 text-white"})}),(0,r.jsx)("span",{className:"font-bold text-base text-amber-900",children:"Points to Award"})]}),(0,r.jsx)("div",{className:"bg-white px-4 py-2 rounded-lg border-2 border-amber-400 shadow-sm",children:(0,r.jsxs)("span",{className:"text-2xl font-black text-amber-700",children:["+",ee()]})})]}),(0,r.jsxs)("p",{className:"text-sm text-amber-800 font-medium",children:["Customer earns ",(0,r.jsx)("strong",{children:"1 point per ฿100"})," spent"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Outlet Location *"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute left-4 top-1/2 -translate-y-1/2",children:(0,r.jsx)(S.Z,{className:"w-5 h-5 text-gray-400"})}),(0,r.jsxs)("select",{className:"w-full pl-12 pr-4 py-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-black focus:border-black text-base font-medium appearance-none bg-white",value:h,onChange:e=>b(e.target.value),required:!0,children:[(0,r.jsx)("option",{value:"",children:"-- Select Outlet --"}),(0,r.jsx)("option",{value:"Sukhumvit",children:"Sarnies Sukhumvit"}),(0,r.jsx)("option",{value:"Old Town",children:"Sarnies Old Town"}),(0,r.jsx)("option",{value:"Roastery",children:"Sarnies Roastery"})]})]})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)("button",{type:"submit",className:"flex-1 py-4 rounded-xl font-bold transition-all shadow-sm ".concat(g||!x||0>=parseFloat(x)?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gray-900 text-white hover:bg-gray-800 hover:shadow-md"),disabled:g||!x||0>=parseFloat(x),children:g?"Processing...":x&&parseFloat(x)>0?"Confirm & Add ".concat(ee()," Points"):"Enter Amount to Continue"}),(0,r.jsx)("button",{type:"button",onClick:ea,className:"px-6 py-4 border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-50 transition-colors disabled:opacity-50",disabled:g,children:"Cancel"})]})]})]})]}),"redeem-voucher"===t&&i&&("employee_vouchers"===i.type||A)&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(m.Z,{customer:i.user,qrType:"employee_vouchers"===i.type?"loyalty_id":"voucher_redemption",showFullDetails:!1}),"employee_vouchers"===i.type?(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 border border-gray-200",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Employee Benefits Available"}),i.vouchers&&i.vouchers.length>0?(0,r.jsx)("div",{className:"space-y-3",children:i.vouchers.map(e=>(0,r.jsx)("button",{onClick:()=>{I(e),d({...i,selectedVoucher:e})},disabled:0===e.available_today,className:"w-full text-left p-4 rounded-xl border-2 transition-all ".concat(0===e.available_today?"bg-gray-100 border-gray-300 opacity-60 cursor-not-allowed":(null==A?void 0:A.id)===e.id?"bg-green-50 border-green-500":"bg-white border-gray-200 hover:border-green-400"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h4",{className:"font-semibold text-gray-900",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),(0,r.jsx)("div",{className:"flex items-center gap-4 mt-2",children:(0,r.jsxs)("span",{className:"text-sm font-medium ".concat(e.available_today>0?"text-green-600":"text-gray-500"),children:["Available today: ",e.available_today,"/",e.max_redemptions_per_user_per_day||"∞"]})})]}),0===e.available_today&&(0,r.jsx)("span",{className:"px-3 py-1 bg-gray-200 text-gray-700 text-xs font-medium rounded-full",children:"Used Today"}),(null==A?void 0:A.id)===e.id&&(0,r.jsx)(f.Z,{className:"w-6 h-6 text-green-600 ml-3"})]})},e.id))}):(0,r.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No employee benefits available"}),A&&(0,r.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,r.jsx)("button",{onClick:et,className:"flex-1 bg-green-600 text-white py-4 rounded-xl font-bold hover:bg-green-700 transition-all shadow-sm hover:shadow-md disabled:opacity-50",disabled:g,children:g?"Processing...":"Confirm Redemption"}),(0,r.jsx)("button",{onClick:ea,className:"px-6 py-4 border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-50 transition-colors",disabled:g,children:"Cancel"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.Z,{voucher:A,qrExpiry:i.voucher.expires_at,customerPointsAfterRedemption:i.user.points_balance,showFullDetails:!0}),(0,r.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 border border-gray-200",children:(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:et,className:"flex-1 bg-green-600 text-white py-5 rounded-xl font-bold hover:bg-green-700 transition-all shadow-sm hover:shadow-md text-lg disabled:opacity-50",disabled:g,children:g?"Processing...":"Redeem Voucher Now"}),(0,r.jsx)("button",{onClick:ea,className:"px-6 py-5 border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-50 transition-colors",disabled:g,children:"Cancel"})]})})]})]}),"success"===t&&(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-12 text-center border-2 border-green-200",children:[(0,r.jsx)("div",{className:"w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,r.jsx)(f.Z,{size:60,className:"text-green-600"})}),(0,r.jsx)("h3",{className:"text-3xl font-bold text-black mb-3",children:"Success!"}),(0,r.jsx)("p",{className:"text-gray-600 text-lg mb-8",children:"Transaction completed successfully"}),(0,r.jsx)("button",{onClick:ea,className:"bg-black text-white px-8 py-4 rounded-xl font-bold hover:bg-gray-800 transition-all shadow-sm hover:shadow-md",children:"Scan Next Customer"})]}),"error"===t&&(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-12 text-center border-2 border-red-200",children:[(0,r.jsx)("div",{className:"w-24 h-24 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,r.jsx)(y.Z,{size:60,className:"text-red-600"})}),(0,r.jsx)("h3",{className:"text-3xl font-bold text-black mb-3",children:"Scan Failed"}),(0,r.jsx)("p",{className:"text-gray-600 text-lg mb-8",children:D}),(0,r.jsx)("button",{onClick:ea,className:"bg-black text-white px-8 py-4 rounded-xl font-bold hover:bg-gray-800 transition-all shadow-sm hover:shadow-md",children:"Try Again"})]}),"manual-entry"===t&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"text-center mb-2",children:[(0,r.jsx)("h1",{className:"text-h2 text-sarnies-black mb-2",children:"Manual Customer Entry"}),(0,r.jsx)("p",{className:"text-sm text-sarnies-midgray",children:"Enter customer ID or phone number"})]}),(0,r.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 border border-gray-200",children:(0,r.jsxs)("form",{onSubmit:er,className:"space-y-5",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Customer ID *"}),(0,r.jsx)("input",{type:"text",className:"w-full px-4 py-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-black focus:border-black text-lg font-semibold",placeholder:"e.g., 123 or member ID",value:O,onChange:e=>T(e.target.value),autoFocus:!0,required:!0}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Customer can find their ID in the app under Profile"})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsx)("button",{type:"submit",className:"flex-1 bg-black text-white py-4 rounded-xl font-bold hover:bg-gray-800 transition-all shadow-sm hover:shadow-md disabled:opacity-50",disabled:g||!O.trim(),children:g?"Searching...":"Find Customer"}),(0,r.jsx)("button",{type:"button",onClick:ea,className:"px-6 py-4 border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-50 transition-colors",disabled:g,children:"Cancel"})]})]})})]}),z&&L&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 animate-in fade-in zoom-in duration-200",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg",children:(0,r.jsx)(y.Z,{className:"w-8 h-8 text-white"})}),(0,r.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Confirm Reward Application"}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Are you sure you want to apply ",(0,r.jsx)("strong",{className:"text-gray-900",children:L.title})," to this transaction?"]})]}),(0,r.jsx)("div",{className:"bg-amber-50 border-2 border-amber-200 rounded-2xl p-4 mb-6",children:(0,r.jsx)("p",{className:"text-sm text-amber-900 font-medium text-center",children:"⚠️ Please confirm with the customer before proceeding"})}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:()=>{M(!1),V(null)},className:"flex-1 py-3 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-bold transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>{L&&(P.ZP.success("".concat(L.title," applied to transaction!")),J(),Y("success"),M(!1),V(null))},className:"flex-1 py-3 px-4 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-xl font-bold shadow-lg shadow-green-500/30 transition-all",children:"Confirm & Apply"})]})]})})]})})}},6469:function(e,s,t){"use strict";t.d(s,{Z:function(){return x}});var r=t(7437),a=t(2265),l=t(3145),n=t(1723),i=t(5252),o=t(3327),d=t(3774),c=t(2252),m=t(5302);function x(e){let{voucher:s,qrExpiry:t,customerPointsAfterRedemption:x,showFullDetails:u=!0}=e,[h,b]=(0,a.useState)(null),[g,p]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(!t)return;let e=()=>{let e=new Date(t).getTime()-Date.now();if(e<=0){p(!0),b(0);return}b(Math.floor(e/1e3))};e();let s=setInterval(e,1e3);return()=>clearInterval(s)},[t]),(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg border-2 border-gray-200 overflow-hidden",children:[t&&(0,r.jsx)("div",{className:"".concat(g?"bg-red-600":h&&h<120?"bg-orange-600":"bg-green-600"," text-white px-5 py-2.5"),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(n.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"font-semibold text-sm",children:g?"QR CODE EXPIRED":"QR Code Expires In"})]}),!g&&null!==h&&(0,r.jsx)("span",{className:"text-xl font-bold font-mono",children:"".concat(Math.floor(h/60),":").concat((h%60).toString().padStart(2,"0"))})]})}),s.image_url&&(0,r.jsx)("div",{className:"relative aspect-[16/9] bg-gray-100",children:(0,r.jsx)(l.default,{src:s.image_url,alt:s.title,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, 600px"})}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4 mb-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-2xl font-bold text-black mb-2",children:s.title}),(0,r.jsx)("p",{className:"text-gray-600 leading-relaxed",children:s.description})]}),(0,r.jsx)("span",{className:"px-3 py-1 bg-purple-100 text-purple-700 text-xs font-bold rounded-full whitespace-nowrap",children:(()=>{switch(s.voucher_type){case"free_item":return"Free Item";case"discount_amount":return"Discount";case"percentage_discount":return"Percentage Off";case"merch":return"Merchandise";default:return"Reward"}})()})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)(i.Z,{className:"w-4 h-4 text-green-700"}),(0,r.jsx)("p",{className:"text-xs font-medium text-green-700",children:"Cash Value"})]}),(0,r.jsxs)("p",{className:"text-3xl font-bold text-green-800",children:["฿",Number(s.cash_value).toFixed(2)]})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl p-4 border border-amber-200",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)(o.Z,{className:"w-4 h-4 text-amber-700"}),(0,r.jsx)("p",{className:"text-xs font-medium text-amber-700",children:"Points Cost"})]}),(0,r.jsx)("p",{className:"text-3xl font-bold text-amber-800",children:s.points_required})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)(d.Z,{className:"w-4 h-4 text-gray-600"}),(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Valid Locations"})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:(s.locations?s.locations.split(",").map(e=>e.trim().toUpperCase()):["ALL LOCATIONS"]).map((e,s)=>(0,r.jsx)("span",{className:"px-3 py-1.5 bg-blue-100 text-blue-800 text-xs font-bold rounded-full border border-blue-200",children:e},s))})]}),u&&(0,r.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-gray-50 rounded-lg",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4 text-gray-600 mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700",children:"Expiry Policy"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["no_expiry"===s.expiry_type&&"This voucher has no expiry date","days_after_redeem"===s.expiry_type&&s.expiry_days&&"Valid for ".concat(s.expiry_days," days after redemption"),"fixed_date"===s.expiry_type&&"Limited time offer - check specific date"]})]})]}),(0,r.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-amber-50 rounded-lg border border-amber-200",children:[(0,r.jsx)(m.Z,{className:"w-4 h-4 text-amber-700 mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-bold text-amber-900",children:"One-Time Use Only"}),(0,r.jsx)("p",{className:"text-sm text-amber-800",children:"This voucher can only be redeemed once"})]})]}),void 0!==x&&(0,r.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[(0,r.jsx)(o.Z,{className:"w-4 h-4 text-blue-700 mt-0.5 flex-shrink-0"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-blue-900",children:"Customer Remaining Points"}),(0,r.jsxs)("p",{className:"text-lg font-bold text-blue-700",children:[x," points"]})]})]})]})]})]})}}},function(e){e.O(0,[1299,3464,368,3145,9950,3729,2971,2117,1744],function(){return e(e.s=2886)}),_N_E=e.O()}]);