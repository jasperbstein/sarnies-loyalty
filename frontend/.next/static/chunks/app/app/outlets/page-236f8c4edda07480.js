(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4302],{2393:function(e,t,a){Promise.resolve().then(a.bind(a,4993))},4993:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(7437),n=a(2265),r=a(7209),i=a(2097),o=a(3774);let l=(0,a(9763).Z)("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);var c=a(3464),d=a(8530),u=a(9064);function h(){let{user:e,token:t}=(0,i.t)(),[a,h]=(0,n.useState)([]),[x,p]=(0,n.useState)(!0),[m,f]=(0,n.useState)(!1),[y,b]=(0,n.useState)(null),[g,j]=(0,n.useState)(!1);(0,n.useEffect)(()=>{v()},[]);let v=async()=>{p(!0);try{let e=await c.Z.get("".concat((0,d.SV)(),"/api/outlets"));h(e.data)}catch(e){u.ZP.error("Failed to load outlets")}finally{p(!1)}},w=e=>{let t="https://www.google.com/maps/dir/?api=1&destination=".concat(e.latitude,",").concat(e.longitude);window.open(t,"_blank")},N=e=>e?e<1e3?"".concat(Math.round(e),"m"):"".concat((e/1e3).toFixed(1),"km"):null;return(0,s.jsx)(r.Z,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-6 pb-20",children:[(0,s.jsxs)("header",{children:[(0,s.jsx)("h1",{className:"text-[28px] font-bold text-gray-900",children:"Sarnies Outlets"}),(0,s.jsx)("p",{className:"text-gray-600 mt-2",children:"Find a location near you"})]}),!g&&(0,s.jsx)("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 rounded-2xl p-6 border border-amber-200",children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(o.Z,{className:"w-6 h-6 text-amber-600"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:"Find nearest outlets"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Enable location to see outlets sorted by distance and get directions"}),(0,s.jsx)("button",{onClick:()=>{if(f(!0),!navigator.geolocation){u.ZP.error("Geolocation is not supported by your browser"),f(!1);return}navigator.geolocation.getCurrentPosition(async a=>{let{latitude:s,longitude:n}=a.coords;if(b({lat:s,lon:n}),j(!0),e&&t)try{await c.Z.put("".concat((0,d.SV)(),"/api/outlets/").concat(e.id,"/location"),{latitude:s,longitude:n,location_enabled:!0},{headers:{Authorization:"Bearer ".concat(t)}})}catch(e){}try{let e=await c.Z.get("".concat((0,d.SV)(),"/api/outlets/nearby?latitude=").concat(s,"&longitude=").concat(n,"&radius=50000"));h(e.data),u.ZP.success("Location updated!")}catch(e){}f(!1)},e=>{u.ZP.error("Unable to get your location"),f(!1)})},disabled:m,className:"bg-amber-600 hover:bg-amber-700 text-white px-6 py-2.5 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:m?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Getting location..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l,{className:"w-4 h-4"}),"Enable Location"]})})]})]})}),x&&(0,s.jsx)("div",{className:"space-y-4",children:[1,2,3].map(e=>(0,s.jsx)("div",{className:"bg-gray-200 rounded-2xl h-32 animate-pulse"},e))}),!x&&(0,s.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:[(0,s.jsx)("div",{className:"flex justify-between items-start mb-4",children:(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:e.name}),e.distance&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-amber-600 font-semibold mt-1",children:[(0,s.jsx)(l,{className:"w-4 h-4"}),N(e.distance)," away"]})]})}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 text-sm text-gray-600",children:[(0,s.jsx)(o.Z,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),(0,s.jsx)("p",{children:e.address})]}),(0,s.jsxs)("button",{onClick:()=>w(e),className:"w-full bg-gray-900 hover:bg-gray-800 text-white py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[(0,s.jsx)(l,{className:"w-4 h-4"}),"Get Directions"]})]})]},e.id))}),!x&&0===a.length&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(o.Z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"No outlets found"})]})]})})}},7209:function(e,t,a){"use strict";a.d(t,{Z:function(){return h}});var s=a(7437),n=a(9376),r=a(2097),i=a(9637),o=a(5080),l=a(5621),c=a(2369),d=a(7692),u=a(2265);function h(e){let{children:t,hideLogout:a=!1}=e,h=(0,n.useRouter)(),x=(0,n.usePathname)(),{user:p,logout:m}=(0,r.t)(),[f,y]=(0,u.useState)(!1);(0,u.useEffect)(()=>{y(!0)},[]);let b=e=>!!e&&("customer"===e.type||"staff"===e.type||"customer"===e.user_type||"employee"===e.user_type||"staff"===e.user_type);if((0,u.useEffect)(()=>{f&&!b(p)&&h.push("/login")},[p,h,f]),!f)return(0,s.jsx)("div",{className:"min-h-screen bg-white flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-black border-t-transparent rounded-full animate-spin"})});if(!b(p))return null;let g=[{icon:i.Z,label:"HOME",path:"/app/home"},{icon:o.Z,label:"VOUCHERS",path:"/app/vouchers"},{icon:l.Z,label:"HISTORY",path:"/app/activity"},{icon:c.Z,label:"PROFILE",path:"/app/profile"}];return(0,s.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,s.jsx)("header",{className:"fixed top-0 left-0 right-0 h-header bg-black z-fixed",children:(0,s.jsxs)("div",{className:"h-full max-w-container mx-auto px-6 flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-label text-white",children:"SARNIES"}),!a&&(0,s.jsx)("button",{onClick:()=>{confirm("Are you sure you want to log out?")&&(m(),h.push("/login"))},className:"p-2.5 -mr-2.5 text-white/60 hover:text-white transition-opacity","aria-label":"Log out",type:"button",children:(0,s.jsx)(d.Z,{className:"w-[18px] h-[18px]",strokeWidth:1.5})})]})}),(0,s.jsx)("main",{className:"pt-header pb-[calc(var(--nav-height)+env(safe-area-inset-bottom,0px)+16px)] min-h-screen",children:(0,s.jsx)("div",{className:"max-w-container mx-auto px-5 py-6",children:t})}),(0,s.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-fixed pb-safe",children:(0,s.jsx)("div",{className:"max-w-container mx-auto px-4",children:(0,s.jsx)("div",{className:"flex justify-around items-start h-[60px] pt-2.5",children:g.map(e=>{let t=e.icon,a=x===e.path||x.startsWith(e.path);return(0,s.jsxs)("button",{onClick:()=>h.push(e.path),className:"flex flex-col items-center justify-start min-w-[64px] py-1 transition-all active:scale-95",children:[(0,s.jsxs)("div",{className:"relative mb-1",children:[(0,s.jsx)(t,{className:"w-[22px] h-[22px] transition-colors ".concat(a?"text-black stroke-[2]":"text-gray-400 stroke-[1.5]")}),a&&(0,s.jsx)("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full ".concat((null==p?void 0:p.user_type)==="employee"?"bg-mustard":"bg-accent")})]}),(0,s.jsx)("span",{className:"text-nav ".concat(a?"text-black":"text-gray-400"),children:e.label})]},e.path)})})})})]})}},8530:function(e,t,a){"use strict";a.d(t,{HE:function(){return i},SV:function(){return n},kG:function(){return r}});var s=a(257);function n(){let e="https://loyalty.sarnies.tech/api";if(e)return e.startsWith("/")?"":e.replace(/\/api\/?$/,"");{let e=(window.location.port,"3000");return"".concat(window.location.protocol,"//").concat(window.location.hostname,":").concat(e)}}function r(){return"https://loyalty.sarnies.tech/api"}function i(){if(s.env.NEXT_PUBLIC_WS_URL)return s.env.NEXT_PUBLIC_WS_URL;let e="https://loyalty.sarnies.tech/api";return e&&e.startsWith("http")?e.replace(/\/api.*$/,""):"".concat(window.location.protocol,"//").concat(window.location.hostname,":3000")}},2097:function(e,t,a){"use strict";a.d(t,{t:function(){return r}});var s=a(9625),n=a(6885);let r=(0,s.Ue)()((0,n.tJ)(e=>({user:null,token:null,hasHydrated:!1,setAuth:(t,a)=>{e({user:t,token:a})},logout:()=>{e({user:null,token:null})},updateUser:t=>{e(e=>e.user?{user:{...e.user,...t}}:e)},setHasHydrated:t=>{e({hasHydrated:t})}}),{name:"auth-storage",storage:(0,n.FL)(()=>localStorage),onRehydrateStorage:()=>e=>{null==e||e.setHasHydrated(!0)}}))},5621:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]])},9637:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]])},7692:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},3774:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},5080:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("Ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]])},2369:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(9763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])}},function(e){e.O(0,[1299,3464,368,2971,2117,1744],function(){return e(e.s=2393)}),_N_E=e.O()}]);