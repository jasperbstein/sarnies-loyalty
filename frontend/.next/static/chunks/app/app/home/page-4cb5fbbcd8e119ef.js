(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4152],{8716:function(e,t,s){Promise.resolve().then(s.bind(s,3275))},3275:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return E}});var a=s(7437),l=s(2265),c=s(7404);let r=e=>{let{name:t,memberId:s,qrCodeUrl:l,qrLoading:r,userType:n}=e;return"employee"===n?(0,a.jsxs)("section",{className:"w-full relative rounded-xl overflow-hidden min-h-[160px]",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:"url(/pattern-bg.jpg)"}}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-black/30 to-black/50"}),(0,a.jsx)("div",{className:"relative z-10 p-6",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-[10px] font-medium uppercase tracking-[0.15em] mb-1.5",style:{color:"rgba(255,255,255,0.7)",textShadow:"0 2px 12px rgba(0,0,0,0.8), 0 0 20px rgba(0,0,0,0.6)"},children:"Welcome back"}),(0,a.jsx)("h1",{className:"text-[22px] font-bold uppercase tracking-[0.2em] text-white mb-2",style:{textShadow:"0 2px 12px rgba(0,0,0,0.8), 0 0 20px rgba(0,0,0,0.6)"},children:t.toUpperCase()}),(0,a.jsxs)("p",{className:"text-xs",style:{color:"rgba(255,255,255,0.7)",textShadow:"0 2px 8px rgba(0,0,0,0.6)"},children:["Employee ID: #",s]})]}),(0,a.jsx)("div",{className:"flex-shrink-0 bg-white rounded-xl w-[100px] h-[100px] flex items-center justify-center",children:r?(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-black border-t-transparent rounded-full animate-spin"}):l?(0,a.jsx)("img",{src:l,alt:"QR Code",className:"w-[80px] h-[80px]"}):(0,a.jsx)(c.Z,{className:"w-14 h-14 text-black"})})]})})]}):(0,a.jsxs)("section",{className:"w-full card-dark",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("p",{className:"text-caption text-white/40 mb-1",children:"Welcome back"}),(0,a.jsx)("h1",{className:"text-heading text-white",children:t.toUpperCase()}),(0,a.jsxs)("p",{className:"text-caption text-white/30 mt-1",children:["Member #",s]})]}),(0,a.jsx)("div",{className:"h-px bg-white/10 mb-4"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0 bg-white rounded-lg p-3",children:r?(0,a.jsx)("div",{className:"w-[100px] h-[100px] flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-black border-t-transparent rounded-full animate-spin"})}):l?(0,a.jsx)("img",{src:l,alt:"QR Code",className:"w-[100px] h-[100px]"}):(0,a.jsx)("div",{className:"w-[100px] h-[100px] flex items-center justify-center bg-gray-100 rounded",children:(0,a.jsx)(c.Z,{className:"w-10 h-10 text-gray-300"})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("div",{className:"w-5 h-5 rounded-full bg-accent/20 flex items-center justify-center",children:(0,a.jsx)(c.Z,{className:"w-3 h-3 text-accent"})}),(0,a.jsx)("span",{className:"text-nav text-accent",children:"SCAN TO REDEEM"})]}),(0,a.jsx)("p",{className:"text-caption text-white/50",children:"Earn & redeem points"})]})]})]})};var n=s(6595);let i=e=>{let{points:t,nextRewardAt:s}=e,l=Math.min(t/s,1),c=s-t;return(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-nav text-gray-400 mb-1",children:"YOUR POINTS"}),(0,a.jsx)("p",{className:"text-3xl font-medium text-accent",children:t})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)("div",{className:"badge-accent",children:[(0,a.jsx)(n.Z,{className:"w-3 h-3 fill-accent text-accent mr-1"}),(0,a.jsx)("span",{className:"text-body",children:t>=s?"Reward unlocked!":"".concat(c," points to reward")})]})}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsxs)("div",{className:"flex justify-between text-caption text-gray-400 mb-1.5",children:[(0,a.jsx)("span",{children:"0"}),(0,a.jsx)("span",{children:s})]}),(0,a.jsx)("div",{className:"h-1 rounded-full bg-gray-100 overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-accent rounded-full transition-all duration-slow",style:{width:"".concat(100*l,"%")}})})]})]})})};var d=s(407),o=s(7414),x=s(5621);let m=e=>{let{onRewards:t,onActivity:s}=e,l=e=>{let{icon:t,title:s,subtitle:l,onClick:c}=e;return(0,a.jsxs)("button",{type:"button",onClick:c,className:"w-full card flex items-center gap-3 p-4 hover:border-gray-300 transition-colors active:scale-[0.98] group",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-gray-200 transition-colors",children:t}),(0,a.jsxs)("div",{className:"flex-1 text-left",children:[(0,a.jsx)("p",{className:"text-base font-medium text-black tracking-tight",children:s}),(0,a.jsx)("p",{className:"text-caption text-gray-500",children:l})]}),(0,a.jsx)(d.Z,{className:"w-4 h-4 text-gray-300 group-hover:translate-x-0.5 transition-transform"})]})};return(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)("h2",{className:"text-label text-black",children:"QUICK ACTIONS"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,a.jsx)(l,{icon:(0,a.jsx)(o.Z,{className:"w-5 h-5 text-black"}),title:"Rewards",subtitle:"Browse & redeem",onClick:t}),(0,a.jsx)(l,{icon:(0,a.jsx)(x.Z,{className:"w-5 h-5 text-black"}),title:"History",subtitle:"View activity",onClick:s})]})]})};var h=s(2096);let u=e=>{let{tag:t,title:s,description:l,imageUrl:c,ctaLabel:r="Read more",onClick:n}=e;return(0,a.jsxs)("article",{onClick:n,className:"card overflow-hidden flex flex-col cursor-pointer hover:border-gray-300 transition-colors active:scale-[0.98] p-0",children:[(0,a.jsxs)("div",{className:"relative w-full h-[140px] bg-gray-100",children:[c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("img",{src:c,alt:s,className:"w-full h-full object-cover"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"})]}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)(h.Z,{className:"w-10 h-10 text-gray-300"})}),t&&(0,a.jsx)("span",{className:"badge-default absolute top-2.5 left-2.5",children:t})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col p-4",children:[(0,a.jsx)("h3",{className:"text-base font-medium text-black tracking-tight leading-snug line-clamp-2 mb-1.5",children:s}),(0,a.jsx)("p",{className:"text-caption text-gray-500 line-clamp-1 flex-1",children:l}),(0,a.jsxs)("div",{className:"flex items-center gap-0.5 mt-3 text-accent",children:[(0,a.jsx)("span",{className:"text-caption font-medium",children:r}),(0,a.jsx)(d.Z,{className:"w-3.5 h-3.5"})]})]})]})};var p=s(9376),b=s(7209),j=s(9116),f=s(2097),v=s(4728),g=s(9347),N=s(3464),w=s(9064),y=s(8530),k=s(1197),_=s(5302),C=s(8680);function E(){var e;let t=(0,p.useRouter)(),{user:s,token:c,hasHydrated:n}=(0,f.t)(),[x,h]=(0,l.useState)([]),[E,S]=(0,l.useState)(!0),[Z,R]=(0,l.useState)(null),[U,A]=(0,l.useState)(!1),[I,M]=(0,l.useState)(!1),[O,T]=(0,l.useState)(null),[V,W]=(0,l.useState)(null),P=(0,l.useRef)(null);(0,g.h)(),(0,l.useEffect)(()=>{M(!0)},[]),(0,l.useEffect)(()=>{if(!I||!(null==s?void 0:s.id)||!c)return;let e=(0,y.HE)(),t=(0,C.io)(e,{transports:["websocket","polling"],auth:{token:c}});return P.current=t,t.on("connect",()=>{t.emit("authenticate",s.id)}),t.on("voucher_redeemed",e=>{setTimeout(()=>{W({voucher_title:e.voucher_title,outlet:e.outlet,cash_value:e.cash_value}),w.ZP.success("".concat(e.voucher_title," redeemed!"),{duration:4e3,icon:"✅"}),z()},800)}),t.on("disconnect",()=>{}),t.on("connect_error",e=>{}),()=>{t.disconnect(),P.current=null}},[I,null==s?void 0:s.id,c]),(0,l.useEffect)(()=>{n&&c&&(B(),D(),H(),z())},[n,c]);let B=async()=>{if(c)try{let e=await N.Z.get("".concat((0,y.SV)(),"/api/auth/me"),{headers:{Authorization:"Bearer ".concat(c)}});f.t.getState().updateUser(e.data.user)}catch(e){}},D=async()=>{try{let e=(null==s?void 0:s.user_type)||"customer",t=await j.oZ.getAll(e);h(t.data.announcements||[])}catch(e){}finally{S(!1)}},H=async()=>{if(s&&c){A(!0);try{let e=await N.Z.get("".concat((0,y.SV)(),"/api/users/").concat(s.id,"/static-qr"),{headers:{Authorization:"Bearer ".concat(c),"Cache-Control":"no-cache",Pragma:"no-cache"}});R(e.data.qr_code)}catch(e){}finally{A(!1)}}},z=async()=>{try{let e=(await j.hO.getAll()).data.vouchers||[];if(e.length>0){let t=[...e].sort((e,t)=>(t.total_redemptions||0)-(e.total_redemptions||0));T(t[0])}}catch(e){}},L=async()=>{await D(),await H(),await z()};if(!I||!n)return(0,a.jsx)(b.Z,{children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)("div",{className:"w-8 h-8 border-2 border-black border-t-transparent rounded-full animate-spin"})})});let Q=(null==s?void 0:s.user_type)==="employee";return(0,a.jsxs)(b.Z,{children:[(0,a.jsx)(v.t,{onRefresh:L,children:(0,a.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,a.jsx)(r,{name:(null==s?void 0:s.name)||"John",memberId:(null==s?void 0:null===(e=s.id)||void 0===e?void 0:e.toString().padStart(6,"0"))||"000001",qrCodeUrl:Z||void 0,qrLoading:U,userType:null==s?void 0:s.user_type}),!Q&&(0,a.jsx)(i,{points:(null==s?void 0:s.points_balance)||0,nextRewardAt:25}),Q&&(0,a.jsxs)("div",{className:"space-y-3",children:[O&&(0,a.jsx)("button",{onClick:()=>t.push("/app/vouchers/".concat(O.id)),className:"w-full rounded-xl p-4 text-left transition-all group bg-white border border-black/10 border-l-4 border-l-mustard hover:bg-gray-50 active:scale-[0.98]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3.5",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center bg-mustard",children:(0,a.jsx)(k.Z,{className:"w-6 h-6 text-black"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-nav text-gray-500 mb-0.5",children:"QUICK REDEEM"}),(0,a.jsx)("h3",{className:"text-body font-medium text-black",children:O.title}),O.max_redemptions_per_user_per_day&&(0,a.jsxs)("p",{className:"text-caption text-gray-400 mt-0.5",children:[Math.max(0,O.max_redemptions_per_user_per_day-(O.redeemed_today||0))," left today"]})]})]}),(0,a.jsx)(d.Z,{className:"w-5 h-5 text-gray-400 group-hover:translate-x-0.5 transition-transform"})]})}),(0,a.jsx)("button",{onClick:()=>t.push("/app/vouchers"),className:"w-full bg-white rounded-xl p-4 border border-black/10 hover:border-black/20 transition-all text-left group active:scale-[0.98]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3.5",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center bg-gray-100 group-hover:bg-gray-200 transition-colors",children:(0,a.jsx)(o.Z,{className:"w-5 h-5 text-black"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-body font-medium text-black",children:"Browse All Benefits"}),(0,a.jsx)("p",{className:"text-caption text-gray-500",children:"View all your employee vouchers"})]})]}),(0,a.jsx)(d.Z,{className:"w-4 h-4 text-gray-400 group-hover:translate-x-0.5 transition-transform"})]})}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-4 border border-black/10",children:[(0,a.jsx)("h3",{className:"text-nav text-black mb-3",children:"HOW IT WORKS"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold mx-auto mb-1.5 bg-mustard text-black",children:"1"}),(0,a.jsx)("p",{className:"text-caption text-gray-500",children:"Choose"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold mx-auto mb-1.5 bg-mustard text-black",children:"2"}),(0,a.jsx)("p",{className:"text-caption text-gray-500",children:"Redeem"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-xs font-semibold mx-auto mb-1.5 bg-mustard text-black",children:"3"}),(0,a.jsx)("p",{className:"text-caption text-gray-500",children:"Show QR"})]})]})]})]}),!Q&&(0,a.jsx)(m,{onRewards:()=>t.push("/app/rewards"),onActivity:()=>t.push("/app/activity")}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-nav text-black mb-3",children:"NEWS & UPDATES"}),E?(0,a.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-black border-t-transparent rounded-full animate-spin"})}):0===x.length?(0,a.jsx)("div",{className:"bg-white rounded-xl p-6 text-center border border-black/10",children:(0,a.jsx)("p",{className:"text-body text-black/40",children:"No announcements at this time"})}):(0,a.jsx)("div",{className:"overflow-x-auto -mx-5 px-5 scrollbar-hide",children:(0,a.jsx)("div",{className:"flex gap-3 pb-2",children:x.map(e=>(0,a.jsx)("div",{className:"flex-shrink-0 w-[240px]",children:(0,a.jsx)(u,{tag:e.announcement_type,title:e.title,description:e.message,imageUrl:e.image_url,onClick:()=>t.push("/app/announcements/".concat(e.id))})},e.id))})})]})]})}),V&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center p-5",onClick:()=>W(null),children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl p-6 max-w-[320px] w-full text-center animate-in zoom-in-95 duration-200",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("div",{className:"w-16 h-16 rounded-full bg-accent-muted flex items-center justify-center mx-auto mb-5",children:(0,a.jsx)(_.Z,{className:"w-9 h-9 text-accent"})}),(0,a.jsx)("h2",{className:"text-label text-black mb-3",children:"VOUCHER REDEEMED"}),(0,a.jsx)("p",{className:"text-body font-semibold text-black mb-1",children:V.voucher_title}),(0,a.jsxs)("p",{className:"text-body text-black/50 mb-4",children:["at ",V.outlet]}),V.cash_value>0&&(0,a.jsx)("div",{className:"badge-accent mb-5",children:(0,a.jsxs)("span",{children:["฿",V.cash_value," Value"]})}),(0,a.jsx)("button",{onClick:()=>W(null),className:"btn-primary w-full",children:"Done"})]})})]})}},8530:function(e,t,s){"use strict";s.d(t,{HE:function(){return r},SV:function(){return l},kG:function(){return c}});var a=s(257);function l(){let e="https://loyalty.sarnies.tech/api";if(e)return e.startsWith("/")?"":e.replace(/\/api\/?$/,"");{let e=(window.location.port,"3000");return"".concat(window.location.protocol,"//").concat(window.location.hostname,":").concat(e)}}function c(){return"https://loyalty.sarnies.tech/api"}function r(){if(a.env.NEXT_PUBLIC_WS_URL)return a.env.NEXT_PUBLIC_WS_URL;let e="https://loyalty.sarnies.tech/api";return e&&e.startsWith("http")?e.replace(/\/api.*$/,""):"".concat(window.location.protocol,"//").concat(window.location.hostname,":3000")}},2096:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9763).Z)("Newspaper",[["path",{d:"M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2",key:"7pis2x"}],["path",{d:"M18 14h-8",key:"sponae"}],["path",{d:"M15 18h-5",key:"95g1m2"}],["path",{d:"M10 6h8v4h-8V6Z",key:"smlsk5"}]])}},function(e){e.O(0,[1299,3464,368,9447,3522,2971,2117,1744],function(){return e(e.s=8716)}),_N_E=e.O()}]);