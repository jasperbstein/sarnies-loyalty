(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3288],{2730:function(e,t,s){Promise.resolve().then(s.bind(s,7637))},7637:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var l=s(7437),a=s(2265),r=s(6189),n=s(9116),i=s(9397),d=s(9763);let x=(0,d.Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]),c=(0,d.Z)("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);var o=s(4401),u=s(2135),m=s(875),h=s(8930),p=s(3639),b=s(401),f=s(8867),j=s(9064);function g(){let[e,t]=(0,a.useState)([]),[s,d]=(0,a.useState)(!0),[g,v]=(0,a.useState)(!1),[y,N]=(0,a.useState)(""),[k,w]=(0,a.useState)(""),[P,Z]=(0,a.useState)(null),[C,S]=(0,a.useState)(!1),[A,_]=(0,a.useState)(null),[I,z]=(0,a.useState)({}),[K,L]=(0,a.useState)(null),[O,T]=(0,a.useState)(!1),[M,E]=(0,a.useState)(null);(0,a.useEffect)(()=>{R()},[]);let R=async()=>{d(!0);try{let e=await n.xf.getAll();t(e.data.keys||[])}catch(e){j.ZP.error("Failed to load API keys")}finally{d(!1)}},q=async e=>{if(I[e]){_(A===e?null:e);return}L(e);try{let t=await n.xf.getLogs(e,{limit:20});z(s=>({...s,[e]:t.data.logs||[]})),_(e)}catch(e){j.ZP.error("Failed to load transaction logs")}finally{L(null)}},F=async()=>{if(!y.trim()){j.ZP.error("Please enter a key name");return}T(!0);try{let e=await n.xf.create({name:y.trim(),outlet_id:k?parseInt(k):void 0});Z(e.data.apiKey),j.ZP.success("API key created successfully"),R()}catch(s){var e,t;j.ZP.error((null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.error)||"Failed to create API key")}finally{T(!1)}},H=async()=>{if(M)try{await n.xf.revoke(M.id),j.ZP.success("API key revoked successfully"),E(null),R()}catch(s){var e,t;j.ZP.error((null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.error)||"Failed to revoke API key")}},V=e=>{navigator.clipboard.writeText(e),S(!0),j.ZP.success("Copied to clipboard"),setTimeout(()=>S(!1),2e3)},D=()=>{v(!1),N(""),w(""),Z(null),S(!1)},U=e=>e?new Date(e).toLocaleString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";return(0,l.jsxs)(r.Z,{children:[(0,l.jsx)("div",{className:"min-h-screen bg-neutral-50",children:(0,l.jsxs)("div",{className:"max-w-[1400px] mx-auto px-6 py-8",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-[28px] font-semibold text-neutral-900",children:"POS API Keys"}),(0,l.jsx)("p",{className:"text-[14px] text-neutral-500 mt-1",children:"Manage API keys for external POS integrations"})]}),(0,l.jsxs)("button",{onClick:()=>v(!0),className:"h-[40px] px-4 rounded-lg bg-neutral-900 text-white hover:bg-neutral-800 text-[14px] font-medium transition-all flex items-center gap-2",children:[(0,l.jsx)(i.Z,{size:16}),"Create API Key"]})]}),(0,l.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6",children:(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)(x,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-[14px] font-semibold text-blue-900 mb-1",children:"External POS Integration"}),(0,l.jsx)("p",{className:"text-[13px] text-blue-700",children:"API keys allow external POS systems to submit transactions and look up customers. Each key is shown only once when created. Store it securely."}),(0,l.jsxs)("div",{className:"mt-3 flex gap-4 text-[12px]",children:[(0,l.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"POST /api/pos/transaction"}),(0,l.jsx)("code",{className:"bg-blue-100 px-2 py-1 rounded text-blue-800",children:"GET /api/pos/lookup/:identifier"})]})]})]})}),(0,l.jsxs)("div",{className:"bg-white border border-neutral-200 rounded-xl shadow-sm overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex items-center h-[48px] px-6 border-b border-neutral-200 bg-neutral-50 text-[11px] font-semibold uppercase tracking-wider text-neutral-600",children:[(0,l.jsx)("div",{className:"w-[200px]",children:"Name"}),(0,l.jsx)("div",{className:"w-[160px]",children:"Key Prefix"}),(0,l.jsx)("div",{className:"w-[100px]",children:"Status"}),(0,l.jsx)("div",{className:"w-[140px]",children:"Last Used"}),(0,l.jsx)("div",{className:"w-[100px] text-right",children:"Requests"}),(0,l.jsx)("div",{className:"w-[100px] text-right",children:"Transactions"}),(0,l.jsx)("div",{className:"w-[140px]",children:"Created"}),(0,l.jsx)("div",{className:"flex-1"})]}),s?(0,l.jsx)("div",{className:"flex items-center justify-center h-40 text-[14px] text-neutral-500",children:"Loading API keys..."}):0===e.length?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 px-4",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-full bg-neutral-100 flex items-center justify-center mb-4",children:(0,l.jsx)(c,{size:24,className:"text-neutral-400"})}),(0,l.jsx)("h3",{className:"text-[16px] font-semibold text-neutral-900 mb-1",children:"No API Keys"}),(0,l.jsx)("p",{className:"text-[14px] text-neutral-500 mb-4",children:"Create your first API key to enable POS integration."}),(0,l.jsxs)("button",{onClick:()=>v(!0),className:"h-[36px] px-4 rounded-lg bg-neutral-900 text-white hover:bg-neutral-800 text-[14px] font-medium transition-all flex items-center gap-2",children:[(0,l.jsx)(i.Z,{size:16}),"Create API Key"]})]}):e.map(e=>{var t,s;return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center h-[60px] px-6 border-b border-neutral-100 last:border-0 hover:bg-neutral-50 transition-colors",children:[(0,l.jsx)("div",{className:"w-[200px]",children:(0,l.jsx)("p",{className:"text-[14px] font-medium text-neutral-900",children:e.name})}),(0,l.jsx)("div",{className:"w-[160px]",children:(0,l.jsxs)("code",{className:"text-[13px] font-mono text-neutral-600 bg-neutral-100 px-2 py-1 rounded",children:[e.key_prefix,"..."]})}),(0,l.jsx)("div",{className:"w-[100px]",children:(0,l.jsx)("span",{className:"inline-flex items-center h-[24px] px-2 rounded-md text-[12px] font-medium ".concat(e.is_active?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:e.is_active?"Active":"Revoked"})}),(0,l.jsx)("div",{className:"w-[140px] text-[13px] text-neutral-600",children:U(e.last_used_at)}),(0,l.jsx)("div",{className:"w-[100px] text-right text-[14px] font-medium text-neutral-900 font-mono",children:e.total_requests.toLocaleString()}),(0,l.jsx)("div",{className:"w-[100px] text-right text-[14px] font-medium text-neutral-900 font-mono",children:e.total_transactions.toLocaleString()}),(0,l.jsx)("div",{className:"w-[140px] text-[13px] text-neutral-500",children:U(e.created_at)}),(0,l.jsxs)("div",{className:"flex-1 flex justify-end gap-2",children:[(0,l.jsxs)("button",{onClick:()=>q(e.id),className:"h-[32px] px-3 rounded-lg border border-neutral-300 bg-white text-neutral-700 hover:bg-neutral-50 text-[13px] font-medium transition-all flex items-center gap-1.5",disabled:K===e.id,children:[(0,l.jsx)(o.Z,{size:14}),"Logs",A===e.id?(0,l.jsx)(u.Z,{size:14}):(0,l.jsx)(m.Z,{size:14})]}),e.is_active&&(0,l.jsxs)("button",{onClick:()=>E(e),className:"h-[32px] px-3 rounded-lg border border-red-200 bg-white text-red-600 hover:bg-red-50 text-[13px] font-medium transition-all flex items-center gap-1.5",children:[(0,l.jsx)(h.Z,{size:14}),"Revoke"]})]})]}),A===e.id&&(0,l.jsxs)("div",{className:"bg-neutral-50 border-b border-neutral-200 px-6 py-4",children:[(0,l.jsx)("h4",{className:"text-[13px] font-semibold text-neutral-700 mb-3",children:"Recent Transaction Logs"}),K===e.id?(0,l.jsx)("p",{className:"text-[13px] text-neutral-500",children:"Loading logs..."}):(null===(t=I[e.id])||void 0===t?void 0:t.length)===0?(0,l.jsx)("p",{className:"text-[13px] text-neutral-500",children:"No transactions recorded yet."}):(0,l.jsx)("div",{className:"space-y-2",children:null===(s=I[e.id])||void 0===s?void 0:s.map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-4 bg-white rounded-lg px-4 py-3 border border-neutral-200",children:[(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"text-[13px] font-mono text-neutral-600",children:e.external_transaction_id}),(0,l.jsx)("span",{className:"inline-flex items-center h-[20px] px-1.5 rounded text-[11px] font-medium ".concat("success"===e.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:e.status})]}),(0,l.jsxs)("p",{className:"text-[12px] text-neutral-500 mt-0.5",children:[e.customer_phone," • ",e.outlet]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsxs)("p",{className:"text-[14px] font-medium text-neutral-900",children:["฿",e.amount_thb.toLocaleString()]}),(0,l.jsxs)("p",{className:"text-[12px] text-green-600",children:["+",e.points_earned," pts"]})]}),(0,l.jsx)("div",{className:"text-[12px] text-neutral-400 w-[120px] text-right",children:U(e.created_at)})]},e.id))})]})]},e.id)})]})]})}),g&&(0,l.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:D}),(0,l.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-xl w-[480px] max-h-[90vh] overflow-y-auto",children:[(0,l.jsx)("div",{className:"p-6 border-b border-neutral-200",children:(0,l.jsx)("h2",{className:"text-[20px] font-semibold text-neutral-900",children:P?"API Key Created":"Create API Key"})}),(0,l.jsx)("div",{className:"p-6",children:P?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)(p.Z,{className:"w-5 h-5 text-amber-600 flex-shrink-0"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-[14px] font-semibold text-amber-800 mb-1",children:"Save this key now"}),(0,l.jsx)("p",{className:"text-[13px] text-amber-700",children:"This is the only time you'll see this API key. Copy and store it securely."})]})]})}),(0,l.jsx)("div",{className:"bg-neutral-100 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("code",{className:"text-[14px] font-mono text-neutral-900 break-all",children:P}),(0,l.jsx)("button",{onClick:()=>V(P),className:"ml-3 p-2 rounded-lg hover:bg-neutral-200 transition-colors flex-shrink-0",children:C?(0,l.jsx)(b.Z,{size:18,className:"text-green-600"}):(0,l.jsx)(f.Z,{size:18,className:"text-neutral-600"})})]})}),(0,l.jsxs)("div",{className:"bg-neutral-50 rounded-lg p-4 text-[13px] text-neutral-600",children:[(0,l.jsx)("p",{className:"font-semibold text-neutral-800 mb-2",children:"Usage:"}),(0,l.jsxs)("code",{className:"block bg-neutral-900 text-green-400 p-3 rounded-lg text-[12px] overflow-x-auto",children:["curl -X POST https://loyalty.sarnies.tech/api/pos/transaction \\",(0,l.jsx)("br",{}),'\xa0\xa0-H "X-API-Key: ',P.substring(0,20),'..." \\',(0,l.jsx)("br",{}),'\xa0\xa0-H "Content-Type: application/json" \\',(0,l.jsx)("br",{}),"\xa0\xa0-d '",'{"customer_phone": "+66...", "amount_thb": 100, ...}',"'"]})]})]}):(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-[13px] font-semibold text-neutral-700 mb-1.5",children:"Key Name"}),(0,l.jsx)("input",{type:"text",value:y,onChange:e=>N(e.target.value),placeholder:"e.g., Main POS System",className:"w-full h-[40px] px-3 border border-neutral-300 rounded-lg text-[14px] text-neutral-900 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent"}),(0,l.jsx)("p",{className:"text-[12px] text-neutral-500 mt-1",children:"A descriptive name to identify this API key"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-[13px] font-semibold text-neutral-700 mb-1.5",children:"Outlet ID (Optional)"}),(0,l.jsx)("input",{type:"text",value:k,onChange:e=>w(e.target.value),placeholder:"Leave empty for all outlets",className:"w-full h-[40px] px-3 border border-neutral-300 rounded-lg text-[14px] text-neutral-900 placeholder:text-neutral-400 focus:outline-none focus:ring-2 focus:ring-neutral-900 focus:border-transparent"}),(0,l.jsx)("p",{className:"text-[12px] text-neutral-500 mt-1",children:"Restrict this key to a specific outlet"})]})]})}),(0,l.jsxs)("div",{className:"p-6 border-t border-neutral-200 flex justify-end gap-3",children:[(0,l.jsx)("button",{onClick:D,className:"h-[40px] px-4 rounded-lg border border-neutral-300 bg-white text-neutral-700 hover:bg-neutral-50 text-[14px] font-medium transition-all",children:P?"Close":"Cancel"}),!P&&(0,l.jsx)("button",{onClick:F,disabled:O||!y.trim(),className:"h-[40px] px-4 rounded-lg bg-neutral-900 text-white hover:bg-neutral-800 text-[14px] font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:O?"Creating...":"Create Key"})]})]})]}),M&&(0,l.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,l.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>E(null)}),(0,l.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-xl w-[400px]",children:[(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center mb-4",children:(0,l.jsx)(p.Z,{size:24,className:"text-red-600"})}),(0,l.jsx)("h2",{className:"text-[20px] font-semibold text-neutral-900 mb-2",children:"Revoke API Key"}),(0,l.jsxs)("p",{className:"text-[14px] text-neutral-600 mb-4",children:["Are you sure you want to revoke ",(0,l.jsx)("strong",{children:M.name}),"? This action cannot be undone and any systems using this key will stop working immediately."]})]}),(0,l.jsxs)("div",{className:"p-6 border-t border-neutral-200 flex justify-end gap-3",children:[(0,l.jsx)("button",{onClick:()=>E(null),className:"h-[40px] px-4 rounded-lg border border-neutral-300 bg-white text-neutral-700 hover:bg-neutral-50 text-[14px] font-medium transition-all",children:"Cancel"}),(0,l.jsx)("button",{onClick:H,className:"h-[40px] px-4 rounded-lg bg-red-600 text-white hover:bg-red-700 text-[14px] font-medium transition-all",children:"Revoke Key"})]})]})]})]})}},4401:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9763).Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]])},3639:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9763).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},401:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9763).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},875:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9763).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},2135:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9763).Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},8867:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9763).Z)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},8930:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(9763).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])}},function(e){e.O(0,[1299,3464,368,5832,2971,2117,1744],function(){return e(e.s=2730)}),_N_E=e.O()}]);