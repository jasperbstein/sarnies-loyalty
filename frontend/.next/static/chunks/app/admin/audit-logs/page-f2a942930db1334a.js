(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6773],{5594:function(e,t,r){Promise.resolve().then(r.bind(r,6362))},6362:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var n=r(7437),s=r(2265),a=r(3247);let l=(0,r(9763).Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);var i=r(2369),c=r(5131),o=r(8530);function d(){let[e,t]=(0,s.useState)([]),[r,d]=(0,s.useState)(!0),[u,x]=(0,s.useState)(""),[m,h]=(0,s.useState)({entityType:"",action:"",severity:"",startDate:"",endDate:""}),[p,f]=(0,s.useState)({page:1,limit:50,total:0,totalPages:0}),[b,g]=(0,s.useState)(null);(0,s.useEffect)(()=>{v()},[m,p.page]);let v=async()=>{try{d(!0);let e=new URLSearchParams({page:p.page.toString(),limit:p.limit.toString(),...m.entityType&&{entityType:m.entityType},...m.action&&{action:m.action},...m.severity&&{severity:m.severity},...m.startDate&&{startDate:m.startDate},...m.endDate&&{endDate:m.endDate}}),r=await fetch("".concat((0,o.kG)(),"/audit-logs?").concat(e),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(r.ok){let e=await r.json();t(e.logs),f(t=>({...t,...e.pagination}))}}catch(e){}finally{d(!1)}},y=e=>{switch(e){case"create":return"text-green-600 bg-green-50";case"update":return"text-blue-600 bg-blue-50";case"delete":return"text-red-600 bg-red-50";case"archive":return"text-orange-600 bg-orange-50";default:return"text-gray-600 bg-gray-50"}},j=e=>{switch(e){case"info":return"text-blue-600 bg-blue-50";case"warning":return"text-orange-600 bg-orange-50";case"critical":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},N=e=>new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),w=e.filter(e=>{var t,r;return""===u||e.description.toLowerCase().includes(u.toLowerCase())||(null===(t=e.user_name)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase()))||(null===(r=e.user_email)||void 0===r?void 0:r.toLowerCase().includes(u.toLowerCase()))});return(0,n.jsxs)("div",{className:"min-h-screen bg-neutral-50 p-8",children:[(0,n.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-neutral-900 mb-2",children:"Audit Logs"}),(0,n.jsx)("p",{className:"text-neutral-600",children:"Track all system activities and changes"})]}),(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-neutral-200 p-6 mb-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,n.jsxs)("div",{className:"lg:col-span-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Search"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(a.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400",size:20}),(0,n.jsx)("input",{type:"text",value:u,onChange:e=>x(e.target.value),placeholder:"Search by description, user...",className:"w-full pl-10 pr-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Entity Type"}),(0,n.jsxs)("select",{value:m.entityType,onChange:e=>h(t=>({...t,entityType:e.target.value})),className:"w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,n.jsx)("option",{value:"",children:"All Types"}),(0,n.jsx)("option",{value:"voucher",children:"Voucher"}),(0,n.jsx)("option",{value:"announcement",children:"Announcement"}),(0,n.jsx)("option",{value:"user",children:"User"}),(0,n.jsx)("option",{value:"transaction",children:"Transaction"}),(0,n.jsx)("option",{value:"points_adjustment",children:"Points Adjustment"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Action"}),(0,n.jsxs)("select",{value:m.action,onChange:e=>h(t=>({...t,action:e.target.value})),className:"w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,n.jsx)("option",{value:"",children:"All Actions"}),(0,n.jsx)("option",{value:"create",children:"Create"}),(0,n.jsx)("option",{value:"update",children:"Update"}),(0,n.jsx)("option",{value:"delete",children:"Delete"}),(0,n.jsx)("option",{value:"archive",children:"Archive"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Severity"}),(0,n.jsxs)("select",{value:m.severity,onChange:e=>h(t=>({...t,severity:e.target.value})),className:"w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,n.jsx)("option",{value:"",children:"All Levels"}),(0,n.jsx)("option",{value:"info",children:"Info"}),(0,n.jsx)("option",{value:"warning",children:"Warning"}),(0,n.jsx)("option",{value:"critical",children:"Critical"})]})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"Start Date"}),(0,n.jsx)("input",{type:"date",value:m.startDate,onChange:e=>h(t=>({...t,startDate:e.target.value})),className:"w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-700 mb-2",children:"End Date"}),(0,n.jsx)("input",{type:"date",value:m.endDate,onChange:e=>h(t=>({...t,endDate:e.target.value})),className:"w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsx)("button",{onClick:()=>{h({entityType:"",action:"",severity:"",startDate:"",endDate:""}),x("")},className:"px-4 py-2 text-sm text-neutral-600 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",children:"Clear All Filters"})})]}),(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-neutral-200 overflow-hidden",children:[r?(0,n.jsxs)("div",{className:"p-12 text-center",children:[(0,n.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"}),(0,n.jsx)("p",{className:"mt-4 text-neutral-600",children:"Loading audit logs..."})]}):0===w.length?(0,n.jsxs)("div",{className:"p-12 text-center",children:[(0,n.jsx)(l,{size:48,className:"mx-auto text-neutral-400 mb-4"}),(0,n.jsx)("p",{className:"text-neutral-600",children:"No audit logs found"})]}):(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full",children:[(0,n.jsx)("thead",{className:"bg-neutral-50 border-b border-neutral-200",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Timestamp"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"User"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Action"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Entity"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Description"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Severity"}),(0,n.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider",children:"Details"})]})}),(0,n.jsx)("tbody",{className:"bg-white divide-y divide-neutral-200",children:w.map(e=>(0,n.jsxs)("tr",{className:"hover:bg-neutral-50 transition-colors",children:[(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900",children:N(e.created_at)}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(i.Z,{size:16,className:"text-neutral-400 mr-2"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm font-medium text-neutral-900",children:e.user_name||"Unknown"}),(0,n.jsx)("div",{className:"text-sm text-neutral-500",children:e.user_email})]})]})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(y(e.action)),children:e.action.toUpperCase()})}),(0,n.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-neutral-900",children:[(0,n.jsx)("div",{className:"font-medium",children:e.entity_type}),e.entity_id&&(0,n.jsxs)("div",{className:"text-neutral-500",children:["ID: ",e.entity_id]})]}),(0,n.jsx)("td",{className:"px-6 py-4 text-sm text-neutral-900 max-w-md truncate",children:e.description}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,n.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(j(e.severity)),children:e.severity.toUpperCase()})}),(0,n.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,n.jsx)("button",{onClick:()=>g(e),className:"text-blue-600 hover:text-blue-800 font-medium",children:"View Details"})})]},e.id))})]})}),!r&&w.length>0&&(0,n.jsxs)("div",{className:"px-6 py-4 bg-neutral-50 border-t border-neutral-200 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"text-sm text-neutral-600",children:["Showing ",(p.page-1)*p.limit+1," to ",Math.min(p.page*p.limit,p.total)," of ",p.total," results"]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>f(e=>({...e,page:e.page-1})),disabled:1===p.page,className:"px-4 py-2 text-sm font-medium text-neutral-700 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,n.jsx)("button",{onClick:()=>f(e=>({...e,page:e.page+1})),disabled:p.page>=p.totalPages,className:"px-4 py-2 text-sm font-medium text-neutral-700 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})]}),b&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:()=>g(null),children:(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("div",{className:"p-6 border-b border-neutral-200",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-neutral-900",children:"Audit Log Details"}),(0,n.jsx)("button",{onClick:()=>g(null),className:"text-neutral-400 hover:text-neutral-600",children:(0,n.jsx)(c.Z,{size:24})})]})}),(0,n.jsxs)("div",{className:"p-6 space-y-6",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-500 mb-1",children:"Action"}),(0,n.jsx)("span",{className:"inline-flex px-3 py-1 text-sm font-semibold rounded-full ".concat(y(b.action)),children:b.action.toUpperCase()})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-500 mb-1",children:"Severity"}),(0,n.jsx)("span",{className:"inline-flex px-3 py-1 text-sm font-semibold rounded-full ".concat(j(b.severity)),children:b.severity.toUpperCase()})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-500 mb-1",children:"Entity Type"}),(0,n.jsx)("p",{className:"text-neutral-900 font-medium",children:b.entity_type})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-500 mb-1",children:"Entity ID"}),(0,n.jsx)("p",{className:"text-neutral-900 font-medium",children:b.entity_id||"N/A"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-500 mb-1",children:"User"}),(0,n.jsx)("p",{className:"text-neutral-900 font-medium",children:b.user_name||"Unknown"}),(0,n.jsx)("p",{className:"text-sm text-neutral-500",children:b.user_email})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-500 mb-1",children:"Timestamp"}),(0,n.jsx)("p",{className:"text-neutral-900 font-medium",children:N(b.created_at)})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-500 mb-1",children:"Description"}),(0,n.jsx)("p",{className:"text-neutral-900",children:b.description})]}),b.changes&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-500 mb-2",children:"Changes"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[b.changes.before&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-neutral-700 mb-2",children:"Before"}),(0,n.jsx)("pre",{className:"bg-neutral-50 p-4 rounded-lg text-xs overflow-x-auto",children:JSON.stringify(b.changes.before,null,2)})]}),b.changes.after&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-neutral-700 mb-2",children:"After"}),(0,n.jsx)("pre",{className:"bg-neutral-50 p-4 rounded-lg text-xs overflow-x-auto",children:JSON.stringify(b.changes.after,null,2)})]})]})]}),b.metadata&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-neutral-500 mb-2",children:"Metadata"}),(0,n.jsx)("pre",{className:"bg-neutral-50 p-4 rounded-lg text-xs overflow-x-auto",children:JSON.stringify(b.metadata,null,2)})]})]})]})})]})}},8530:function(e,t,r){"use strict";r.d(t,{HE:function(){return l},SV:function(){return s},kG:function(){return a}});var n=r(257);function s(){let e="https://loyalty.sarnies.tech/api";if(e)return e.startsWith("/")?"":e.replace(/\/api\/?$/,"");{let e=(window.location.port,"3000");return"".concat(window.location.protocol,"//").concat(window.location.hostname,":").concat(e)}}function a(){return"https://loyalty.sarnies.tech/api"}function l(){if(n.env.NEXT_PUBLIC_WS_URL)return n.env.NEXT_PUBLIC_WS_URL;let e="https://loyalty.sarnies.tech/api";return e&&e.startsWith("http")?e.replace(/\/api.*$/,""):"".concat(window.location.protocol,"//").concat(window.location.hostname,":3000")}},9763:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(2265),s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),l=(e,t)=>{let r=(0,n.forwardRef)((r,l)=>{let{color:i="currentColor",size:c=24,strokeWidth:o=2,absoluteStrokeWidth:d,className:u="",children:x,...m}=r;return(0,n.createElement)("svg",{ref:l,...s,width:c,height:c,stroke:i,strokeWidth:d?24*Number(o)/Number(c):o,className:["lucide","lucide-".concat(a(e)),u].join(" "),...m},[...t.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(x)?x:[x]])});return r.displayName="".concat(e),r}},3247:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9763).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},2369:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},5131:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9763).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},257:function(e,t,r){"use strict";var n,s;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,n,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:l}catch(e){r=l}}();var c=[],o=!1,d=-1;function u(){o&&n&&(o=!1,n.length?c=n.concat(c):d=-1,c.length&&x())}function x(){if(!o){var e=i(u);o=!0;for(var t=c.length;t;){for(n=c,c=[];++d<t;)n&&n[d].run();d=-1,t=c.length}n=null,o=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===l||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new m(e,t)),1!==c.length||o||i(x)},m.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=h,s.addListener=h,s.once=h,s.off=h,s.removeListener=h,s.removeAllListeners=h,s.emit=h,s.prependListener=h,s.prependOnceListener=h,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var a=r[e]={exports:{}},l=!0;try{t[e](a,a.exports,n),l=!1}finally{l&&delete r[e]}return a.exports}n.ab="//";var s=n(229);e.exports=s}()}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=5594)}),_N_E=e.O()}]);